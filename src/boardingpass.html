<!-- TEST URL 

killall chromium-browser
export DISPLAY=:0
chromium-browser --noerrdialogs --ignore-gpu-blacklist --disable-infobars --disable-session-crashed-bubble --incognito --kiosk --start-maximized http://10.3.141.1:3000/boardingpass
-->
<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <title>NJOY</title>
        <link rel="stylesheet" type="text/css" href="css/app.css">
        <link rel="stylesheet" type="text/css" href="css/boardingpass.css">
        <link rel="stylesheet" type="text/css" href="pages/boardingpass/forbansjs/forbans.css">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
        <!--<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>-->
        <!--<script type="text/javascript" src="js/lettering.js"></script>
        <script type="text/javascript" src="pages/boardingpass/flapper/jshashtable-2.1/jshashtable.js"></script>-->
        <script type="text/javascript" src="pages/boardingpass/forbansjs/forbansjs.js"></script>
        
        <script type="text/javascript" src="js/EaselJS/lib/easeljs-0.8.1.combined.js"></script>
        <script type="text/javascript" src="node_modules/gsap/TweenMax.js"></script>
        <script type="text/javascript" src="js/socket.io/socket.io.js"></script>
        <script src="node_modules/vue/dist/vue.min.js"></script>
    </head>
    <body>
        <div id="boardingpass" class="boardingpass">
            <div class="airportPanel">
                <div v-for='(item, index) in enigmes' v-bind:id="'flapper_'+index">{{ setForban(item.value, index) }}</div>
            </div>
        </div>
        <script>
            var vm = new Vue({
                el: '#boardingpass',
                data: {
                    activities: [],
                    message: 'BOARDINGPASS',
                    forbans:[],
                    lines:15,
                    enigmes:[
                        {value:"OU PART LE BALAIS DE PAILLE AVEC LE RAMASSE POUSSIERE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"},
                        {value:"TEST MY FLIP FLAP FORBANS LINE"}
                    ],
                    infos:{
                        datas:{
                            teams: []
                        }
                    },
                    options: {
                        width: 53*9,          // number of digits
                        format: null,         // optio  ns for jquery.numberformatter, if loaded
                        align: 'left',        // aligns values to the left or right of display
                        padding: '&nbsp;',    // value to use for padding
                        chars: null,          // array of characters that Flapper can display
                        chars_preset: 'alphanum',  // 'num', 'hexnum', 'alpha' or 'alphanum'
                        timing: 50,          // the maximum timing for digit animation
                        min_timing: 10,       // the minimum timing for digit animation
                        threshhold: 1,      // the point at which Flapper will switch from
                        transform: false,      // Flapper automatically detects the jquery.transform
                        on_anim_start: this.onAnimStart,   // Callback for start of animation
                        on_anim_end: this.onAnimEnd     // Callback for end of animation
                    },
                    socket: io(window.location.origin, {transports: ['websocket', 'xhr-polling']})
                },
                created: function() {
                    this.socket.on('error', function(e) {
                        console.log('error socket');
                    });
                    this.socket.on('connect_failed', function(e) {
                        console.log("connect_failed");
                    });
                    this.socket.on('connect', function(e) {
                        console.log("socket_connected");
                    });
                    this.socket.on('boardingpass', function(datas) {
                        /* GESTION DE CAS SPECIFIQUES */
                        // SAMPLE CALL EMIT : vm.socket.emit('boardingpass', {status:"updateLine", value:"BONJOUR TOUT LE MONDE", line:4})
                        switch(datas.status){
                            case 'updateLine':
                                //var space = " ";
                                //(datas.value.length < 53)? datas.value += space.repeat(53 - datas.value.length) : datas.value = datas.value.subString(0, 52);
                                //this.enigmes[datas.num] = datas.value;
                                this.displayLine(datas.line, datas.value);
                                break;
                            default:
                                break;
                        }
                    }.bind(this));
                    //SET DISPLAY
                    /*
                    killall chromium-browser
                    export DISPLAY=:0
                    chromium-browser --noerrdialogs --ignore-gpu-blacklist --disable-infobars --disable-session-crashed-bubble --incognito --kiosk --start-maximized $
                    */
                    $(document).ready(function(){
                        setTimeout(function(){
                            
                        }.bind(this), 2000);
                    }.bind(this));
                },
                computed: {
                    setClass: function(){
                        return {
                            unknow: false,
                            selected: true
                        }
                    }
                },
                methods: {
                    defaultFunc: function(){
                        console.log('default function');
                    },
                    setForban: function(value, index){
                        this.forbans[index] = new forbans();
                        setTimeout(function(){
                            this.forbans[index].init(document.getElementById('flapper_'+index), {
                                charMax:53,
                                delat:2,
                                duration:200,
                                iteration:0,
                                value:value
                            }, function(event){
                                console.log(event);
                            });
                        }.bind(this), (index*250));
                        
                        //return value;
                    },
                    displayLine: function(id, value){
                        console.log(id, value);
                        this.forbans[id].setValue(value);
                    },
                    onAnimStart: function(e) {
                        console.log('start ', e);
                        var $display = $(e.target);

                        $display.prevUntil('.flapper', '.activity').addClass('active');
                    },
                    onAnimEnd: function(e) {
                        console.log('end ', e);
                        var $display = $(e.target);
                        $display.prevUntil('.flapper', '.activity').removeClass('active');
                    }
                }
            });


        </script>
        <style>
            
        </style>
    </body>
</html>
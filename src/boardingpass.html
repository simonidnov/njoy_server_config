<!-- TEST URL 
NOTE IMPORTANT 
on a supprimé  --disable-gpu-compositing dans la config chromium du fichier  /etc/chromium-browser/customizations/00-rpi-var
killall chromium-browser
export DISPLAY=:0
chromium-browser --noerrdialogs --ignore-gpu-blacklist --disable-infobars --disable-session-crashed-bubble --incognito --kiosk --start-maximized http://10.3.141.1:3000/boardingpass
-->
<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <title>NJOY</title>
        <link rel="stylesheet" type="text/css" href="css/app.css">
        <link rel="stylesheet" type="text/css" href="css/boardingpass.css">
        <link rel="stylesheet" type="text/css" href="pages/boardingpass/forbansjs/forbans.css">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
        <!--<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>-->
        <!--<script type="text/javascript" src="js/lettering.js"></script>
        <script type="text/javascript" src="pages/boardingpass/flapper/jshashtable-2.1/jshashtable.js"></script>-->
        <script type="text/javascript" src="pages/boardingpass/forbansjs/forbansjs.js"></script>
        
        <script type="text/javascript" src="js/EaselJS/lib/easeljs-0.8.1.combined.js"></script>

        <script src="pages/boardingpass/js/jquery/jquery.splitflap.js"></script>

        <script type="text/javascript" src="node_modules/underscore/underscore-min.js"></script>
        <script type="text/javascript" src="node_modules/gsap/TweenMax.js"></script>
        <script type="text/javascript" src="node_modules/gsap/TweenLite.js"></script>
        <script type="text/javascript" src="js/socket.io/socket.io.js"></script>
        <script src="node_modules/vue/dist/vue.min.js"></script>


        <style>
            body {
                margin: 0;
                padding: 20px;
                background: grey;
                color: white;
    
                font-family: Tahoma, Geneva, sans-serif;
                font-size: 24px;
            }
    
            .example {
                padding: 0 0 10px;
                margin-bottom: 20px;
    
                box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            }
    
            h1 {
                margin: 0 0 10px;
                padding: 10px;
                font-size: 16px;
                font-weight: normal;
                background: #333333;
            }
    
            .splitflap {
                margin: 0 auto;
    
                -webkit-perspective-origin: top center;
                -moz-perspective-origin: top center;
                -ms-perspective-origin: top center;
                perspective-origin: top center;
    
                -webkit-perspective: 900px;
                -moz-perspective: 900px;
                -ms-perspective: 900px;
                perspective: 900px;
            }
        </style>
    </head>
    <body>
        <div id="boardingpass" class="boardingpass">
            <!--<div class="airportPanel">
                <div v-for='(item, index) in enigmes' v-bind:id="'flapper_'+index">{{ setForban(item.value, index) }}</div>
            </div>-->
            <div class="example">
                <!--<div v-for='(item, index) in questions' class="splitflap" v-bind:id="'flap_'+index">{{ setFlap(item.question, index) }}</div>-->
                <div class="splitflap" id="flap_0" data-line="0">{{ questions[0].question }}</div>
                <div class="splitflap" id="flap_1" data-line="1">{{ questions[1].question }}</div>
                <div class="splitflap" id="flap_2" data-line="2">{{ questions[2].question }}</div>
                <div class="splitflap" id="flap_3" data-line="3">{{ questions[3].question }}</div>
                <div class="splitflap" id="flap_4" data-line="4">{{ questions[4].question }}</div>
                <div class="splitflap" id="flap_5" data-line="5">{{ questions[5].question }}</div>
                <div class="splitflap" id="flap_6" data-line="6">{{ questions[6].question }}</div>
                <div class="splitflap" id="flap_7" data-line="7">{{ questions[7].question }}</div>
                <div class="splitflap" id="flap_8" data-line="8">{{ questions[8].question }}</div>
                <!--<div class="splitflap" id="flap_9" data-line="9">{{ questions[9].question }}</div>
                <div class="splitflap" id="flap_10" data-line="10">{{ questions[10].question }}</div>
                <div class="splitflap" id="flap_11" data-line="11">{{ questions[11].question }}</div>
                <div class="splitflap" id="flap_12" data-line="12">{{ questions[12].question }}</div>
                <div class="splitflap" id="flap_13" data-line="13">{{ questions[13].question }}</div>
                <div class="splitflap" id="flap_14" data-line="14">{{ questions[14].question }}</div>
                <div class="splitflap" id="flap_15" data-line="15">{{ questions[15].question }}</div>
                <div class="splitflap" id="flap_16" data-line="16">{{ questions[16].question }}</div>
                <div class="splitflap" id="flap_17" data-line="17">{{ questions[17].question }}</div>
                <div class="splitflap" id="flap_18" data-line="18">{{ questions[18].question }}</div>
                <div class="splitflap" id="flap_19" data-line="19">{{ questions[19].question }}</div>-->
            </div>
        </div>
        <script>
            var init_table = [],
                space = " ",
                init_question = space.repeat(54);

            for(var t=0; t<20; t++){
                init_table.push({id:t, "question":init_question, "answer":"undefined", success:false, refreshed : false})
            }
            var global_questions = {
                "co-pilote":[
                    {"question":"Ou partent la brosse à cheveux et la brosse a dent ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part le poivrier ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part le balai synthétique ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part les menottes ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part la télécommande ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part la raquette de ping-pong ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part l'écrou ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part le verre ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part l'aspirateur ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le cuter ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le porte monnaie ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le puzzle ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part la poire ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le ballon de rugby ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le CD ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le livre ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part l'aimant ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part la marguerite ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part le boule de bowling ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part le réveil ?", "answer":"Amman"}
                ],
                "pilote":[
                    {"question":"NIVEAU 2 Dans quelle ville part la boite de conserve ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part le poivrier ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part le balai synthétique ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part les menottes ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part la télécommande ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part la raquette de ping-pong ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part l'écrou ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part le verre ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part l'aspirateur ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le cuter ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le porte monnaie ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le puzzle ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part la poire ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le ballon de rugby ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le CD ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le livre ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part l'aimant ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part la marguerite ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part le boule de bowling ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part le réveil ?", "answer":"Amman"}
                ],
                "expert":[
                    {"question":"Dans quelle ville part la boite de conserve ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part le poivrier ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part le balai synthétique ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part les menottes ?", "answer":"Abidjan"},
                    {"question":"Dans quelle ville part la télécommande ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part la raquette de ping-pong ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part l'écrou ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part le verre ?", "answer":"Abu Dhabi"},
                    {"question":"Dans quelle ville part l'aspirateur ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le cuter ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le porte monnaie ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part le puzzle ?", "answer":"Ajaccio"},
                    {"question":"Dans quelle ville part la poire ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le ballon de rugby ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le CD ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part le livre ?", "answer":"Alger"},
                    {"question":"Dans quelle ville part l'aimant ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part la marguerite ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part le boule de bowling ?", "answer":"Amman"},
                    {"question":"Dans quelle ville part le réveil ?", "answer":"Amman"}
                ]
            }
            for(var i=0; i<Object.keys(global_questions).length; i++){
                console.log(Object.keys(global_questions)[i]);
                var key = Object.keys(global_questions)[i];
                for(var a=0; a<global_questions[key].length; a++){
                    global_questions[key][a].id = a;
                    global_questions[key][a].success = 0;
                    global_questions[key][a].refreshed = 0;
                }
            }
            var vm = new Vue({
                el: '#boardingpass',
                data: {
                    activities: [],
                    message: 'BOARDINGPASS',
                    forbans:[],
                    questions:_.shuffle(_.where(global_questions['co-pilote'], {success:0})).slice(0, 9),
                    lines:15,
                    ratio:.4,
                    enigmes:[
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""},
                        {value:""}
                    ],
                    infos:{
                        datas:{
                            teams: []
                        }
                    },
                    options: {
                        width: 53*9,          // number of digits
                        format: null,         // optio  ns for jquery.numberformatter, if loaded
                        align: 'left',        // aligns values to the left or right of display
                        padding: '&nbsp;',    // value to use for padding
                        chars: null,          // array of characters that Flapper can display
                        chars_preset: 'alphanum',  // 'num', 'hexnum', 'alpha' or 'alphanum'
                        timing: 50,          // the maximum timing for digit animation
                        min_timing: 10,       // the minimum timing for digit animation
                        threshhold: 1,      // the point at which Flapper will switch from
                        transform: false,      // Flapper automatically detects the jquery.transform
                        on_anim_start: this.onAnimStart,   // Callback for start of animation
                        on_anim_end: this.onAnimEnd     // Callback for end of animation
                    },
                    socket: io(window.location.origin, {transports: ['websocket', 'xhr-polling']})
                },
                created: function() {
                    //this.questions = init_table;
                    this.socket.on('error', function(e) {
                        console.log('error socket');
                    });
                    this.socket.on('connect_failed', function(e) {
                        console.log("connect_failed");
                    });
                    this.socket.on('connect', function(e) {
                        console.log("socket_connected");
                    });
                    this.socket.on('redirect', function(datas){
                        console.log('datas redirect ', datas);
                        window.location.href = datas.url;
                    });
                    this.socket.on('boardingpass', function(datas) {
                        /* GESTION DE CAS SPECIFIQUES */
                        // SAMPLE CALL EMIT : vm.socket.emit('boardingpass', {status:"updateLine", value:"BONJOUR TOUT LE MONDE", line:4})
                        switch(datas.status){
                            case 'getQuestions':
                                // ON CREE UN RANDOM DE QUESTIONS SELON LE LEVEL ENVOYE
                                this.questions = global_questions[datas.level];
                                // ON ENVOIE LES QUESTIONS A L APP
                                this.socket.emit('boardingpass', {status:"sendQuestions", questions:this.questions});
                                // ON MET A JOUR LE TABLEAU COTE DISPLAY PUBLIC
                                this.show_questions();
                                break;
                            case 'sendQuestions':
                                // DE CE COTE ON NE FAIT RIEN CAR NOUS VENONS DE RENVOYER LES QUESTIONS A L APP
                                break;
                            case 'refreshLine':
                                // TODO REFFRESSH LINE
                                break;
                            case 'valideLine':
                                // TODO VALIDE LINE
                                break;
                            case 'sendLine':
                                // ICI ON NE FAIS RIEN
                                this.update_line();
                                break;
                            case 'updateLine':
                                console.log(datas);
                                //var space = " ";
                                //(datas.value.length < 53)? datas.value += space.repeat(53 - datas.value.length) : datas.value = datas.value.subString(0, 52);
                                //this.enigmes[datas.num] = datas.value;
                                this.displayLine(datas.line, this.questions[datas.line].question);
                                break;
                            default:
                                break;
                        }
                    }.bind(this));

                    this.init_flaps(0);
                    //SET DISPLAY
                    /*
                    killall chromium-browser
                    export DISPLAY=:0
                    chromium-browser --noerrdialogs --ignore-gpu-blacklist --disable-infobars --disable-session-crashed-bubble --incognito --kiosk --start-maximized $
                    */
                },
                computed: {
                    setClass: function(){
                        return {
                            unknow: false,
                            selected: true
                        }
                    }
                },
                methods: {
                    init_flaps : function(){
                        var ratio = this.ratio,
                            self = this,
                            space = " ";
                        $(".splitflap")
                        .splitFlap({
                            charWidth:  50 * ratio,
                            charHeight: 100 * ratio,
                            imageSize:  (2500 * ratio) + 'px ' + (100 * ratio) + 'px',
                            autoplay:   true,
                            text:           space.repeat(54),
                            textInit:       space.repeat(54),
                            speed:          20,
                            onComplete: function () {
                                
                            }
                        });
                        setTimeout(function(){
                            self.settingFlap(0);
                        }, 400);
                    },
                    settingFlap:function(index){
                        var ratio = this.ratio,
                            value = this.questions[index].question,
                            self = this,
                            space = " ";
                        (value.length < 54)? value += space.repeat(54 - value.length) : value = value.substring(0, 54);
                        console.log('VALUE ', value, index);
                        $("#flap_"+index)
                            .splitFlap({
                                charWidth:  50 * ratio,
                                charHeight: 100 * ratio,
                                imageSize:  (2500 * ratio) + 'px ' + (100 * ratio) + 'px',
                                autoplay:   true,
                            	charsMap:   "ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789.,!?#@()+-=É'",
                                text:           value.normalize('NFD').replace(/[\u0300-\u036f]/g, "").toUpperCase(),
                                textInit:       space.repeat(54),
                                speed:          100,
                                speedVariation: 2,
                                onComplete: function () {
                                    console.log('Done !');
                                }
                            });
                        setTimeout(function(){
                            if(index < self.questions.length-1){
                                index++;
                                self.settingFlap(index);
                            }
                        }.bind(this), 100);
                    },
                    defaultFunc: function(){
                        console.log('default function');
                    },
                    show_questions : function(){
                        console.log('ON AFFICHE LES QUESTIONS');
                    },
                    setFlap: function(value, index){
                        //console.log('setflap ', value, index);
                        var space = " ";
                        (value.length < 54)? value += space.repeat(54 - value.length) : value = value.substring(0, 54);
                        $("#flap_"+index).html(value);
                        var ratio = this.ratio;
                        setTimeout(function(){
                            $("#flap_"+index)
                                .splitFlap({
                                    charWidth:  50 * ratio,
                                    charHeight: 100 * ratio,
                                    imageSize:  (2500 * ratio) + 'px ' + (100 * ratio) + 'px',
                                    autoplay:   true,
                                    text:           value,
                                    textInit:       space.repeat(54),
                                    speed:          20,
                                    onComplete: function () {
                                        console.log('Done !');
                                    }
                                });
                        }.bind(this), 200);
                        
                        //$("#flap_"+id).splitFlap('splitflap').animate();
                    },
                    displayLine: function(id, value){
                        console.log(id, value);
                        //this.questions[id].question = "HELL BILLU";
                        /*var space = " ";
                        (value.length < 54)? value += space.repeat(54 - value.length) : value = value.substring(0, 54);
                        $("#flap_"+id).html(value);
                        var ratio = 0.5;
                        $("#flap_"+id)
                                .splitFlap({
                                    charWidth:  50 * ratio,
                                    charHeight: 100 * ratio,
                                    imageSize:  (2500 * ratio) + 'px ' + (100 * ratio) + 'px',
                                    textInit:   'Click me                                   ',
                                    autoplay:   true,
                                    text:           value,
                                    speed:          20,
                                    onComplete: function () {
                                        console.log('Done !');
                                    }
                                });*/
                        //$("#flap_"+id).splitFlap('splitflap').animate();
                        //this.forbans[id].setValue(value);
                    },
                    onAnimStart: function(e) {
                        console.log('start ', e);
                        var $display = $(e.target);

                        $display.prevUntil('.flapper', '.activity').addClass('active');
                    },
                    onAnimEnd: function(e) {
                        console.log('end ', e);
                        var $display = $(e.target);
                        $display.prevUntil('.flapper', '.activity').removeClass('active');
                    }
                }
            });

            
        </script>



        <!--<script>
            (function ($) {
                $(document).ready(function () {
                    console.log('SET FLAP');
                    var space = " ";
                    spaces = space.repeat(54);
                    $('.splitflap').html(spaces);
                    var ratio = 0.5;
                    $('.splitflap')
                            .splitFlap({
                                charWidth:  50 * ratio,
                                charHeight: 100 * ratio,
                                imageSize:  (2500 * ratio) + 'px ' + (100 * ratio) + 'px',
                                textInit:   spaces,
                                autoplay:   false,
                                onComplete: function () {
                                    console.log('Done !');
                                }
                            });

                    /*
                    $('.empty-splitflap')
                            .splitFlap({
                                text: 'This is JS'
                            });

                    var ratio = 0.5;
                    $('.resized-splitflap')
                            .splitFlap({
                                charWidth:  50 * ratio,
                                charHeight: 100 * ratio,
                                imageSize:  (2500 * ratio) + 'px ' + (100 * ratio) + 'px'
                            });
                            */
                });
            })(jQuery);
        </script>-->

        <style>
            
        </style>
    </body>
</html>
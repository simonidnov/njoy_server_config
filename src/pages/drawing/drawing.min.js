var drawing={drawing_tool:null,init:function(){setTimeout(function(){drawing.drawing_tool=new drawer("drawer"),drawing.drawing_tool.init(),console.log("drawing.drawing_tool === ",drawing.drawing_tool),app.socket.emit("njoy",{status:"init_drawing",color:createjs.Graphics.getRGB(0,0,0),width:1920,height:1080})},500)},destroy:function(){}},drawer=function(t){this.canvas=document.getElementById(t);this.canvas.width=1920,this.canvas.height=1080,this.canvas.style.width=1920,this.canvas.style.height=1080,this.lastSend=(new Date).getTime(),this.color="#000000",this.size=10;var s=window.innerHeight/$("#drawer").height();$("#"+t).css({transform:"scale("+s+")",left:-((1920*s-window.innerWidth)/2)}),this.pencil={color:this.color,size:this.size,stylingW:"round",stylingH:"round"},this.stage=new createjs.Stage(t),this.stage.autoClear=!0,this.stage.update(),this.touchPos={x:0,y:0},this.isMouseDown=!1,this.currentShape=[],createjs.Ticker.setFPS(60),createjs.Ticker.addEventListener("tick",$.proxy(function(){this.update()},this))};drawer.prototype.open_close_pencil=function(){$(".pencil_menu").hasClass("opened")?$(".pencil_menu").removeClass("opened"):$(".pencil_menu").addClass("opened")},drawer.prototype.set_pencil=function(t){$.each(_.keys(t),$.proxy(function(e,s){this.pencil[s]=t[s]},this))},drawer.prototype.init=function(){this.create_events();var t=this;$("[data-color]").off("click").on("click",function(){t.color=$(this).attr("data-color"),t.pencil.color=$(this).attr("data-color"),$("[data-color]").removeClass("selected"),$(this).addClass("selected"),t.open_close_pencil()}),$("[data-size]").off("click").on("click",function(){t.size=$(this).attr("data-size"),t.pencil.size=$(this).attr("data-size"),$("[data-size]").removeClass("selected"),$(this).addClass("selected"),t.open_close_pencil()}),$("[data-clearcanvas]").off("click").on("click",function(){t.stage.removeAllChildren(),t.stage.update(),app.socket.emit("njoy",{status:"drawing_clear",x:this.oldX,y:this.oldY}),t.open_close_pencil()}),$(".open_close_pencil_menu").off("click").on("click",function(){t.open_close_pencil()})},drawer.prototype.create_events=function(){createjs.Touch.enable(this.stage),this.stage.on("stagemousedown",$.proxy(function(t){this.isMouseDown=!0;var e=new createjs.Shape;"ontouchstart"in window?(this.oldX=t.stageX,this.oldY=t.stageY,this.oldMidX=t.stageX,this.oldMidY=t.stageY,this.touchPos={x:t.stageX,y:t.stageY}):(this.oldX=this.stage.mouseX,this.oldY=this.stage.mouseY,this.oldMidX=this.stage.mouseX,this.oldMidY=this.stage.mouseY);var s=e.graphics;s.setStrokeStyle(10,"round","round");createjs.Graphics.getRGB(0,0,0);s.beginStroke(this.pencil.color),this.stage.addChild(e),this.currentShape[this.currentShape.length]=e,app.socket.emit("njoy",{status:"drawing_point",x:this.oldX,y:this.oldY})},this)),this.stage.on("stagemousemove",$.proxy(function(t){this.touchPos={x:t.stageX,y:t.stageY}},this)),this.stage.on("stagemouseup",$.proxy(function(t){if(this.isMouseDown=!1,null!==this.touchPos)var e=new createjs.Point(this.touchPos.x,this.touchPos.y);else var e=new createjs.Point(this.stage.mouseX,this.stage.mouseY);var s=new createjs.Point(this.oldX+e.x>>1,this.oldY+e.y>>1);app.socket.emit("njoy",{status:"drawing",color:this.color,strokestyle:{size:this.pencil.size,stylingH:this.pencil.stylingH,stylingW:this.pencil.stylingW},type:"moveTo",x:s.x,y:s.y,curve:{oldX:this.oldX,oldY:this.oldY,oldMidX:this.oldMidX,oldMidY:this.oldMidY}})},this))},drawer.prototype.update=function(){if(this.isMouseDown){if(null!==this.touchPos)var t=new createjs.Point(this.touchPos.x,this.touchPos.y);else var t=new createjs.Point(this.stage.mouseX,this.stage.mouseY);var e=new createjs.Point(this.oldX+t.x>>1,this.oldY+t.y>>1);"undefined"!=typeof this.currentShape[this.currentShape.length-1]&&(this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(this.pencil.size,this.pencil.stylingW,this.pencil.stylingH),this.currentShape[this.currentShape.length-1].graphics.moveTo(e.x,e.y),this.currentShape[this.currentShape.length-1].graphics.curveTo(this.oldX,this.oldY,this.oldMidX,this.oldMidY)),this.oldX=t.x,this.oldY=t.y,this.oldMidX=e.x,this.oldMidY=e.y,this.stage.update(),this._removed=[],(new Date).getTime()-this.lastSend>50&&(app.socket.emit("njoy",{status:"drawing",color:this.color,strokestyle:{size:this.pencil.size,stylingH:this.pencil.stylingH,stylingW:this.pencil.stylingW},type:"moveTo",x:e.x,y:e.y,curve:{oldX:this.oldX,oldY:this.oldY,oldMidX:this.oldMidX,oldMidY:this.oldMidY}}),this.lastSend=(new Date).getTime())}},drawer.prototype.cancel=function(){},drawer.prototype.clear=function(){},drawer.prototype.destroy=function(){};
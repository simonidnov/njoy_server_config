var drawing={drawing_tool:null,init:function(){app.init(function(){});setTimeout(function(){drawing.drawing_tool=new drawer("drawer");drawing.drawing_tool.init();console.log("drawing.drawing_tool === ",drawing.drawing_tool);app.socket_callback=$.proxy(function(a){console.log(a)},this);app.socket.emit("njoy",{status:"init_drawing",color:createjs.Graphics.getRGB(0,0,0),width:1920,height:1080})},500)},destroy:function(){}};var drawer=function(b){this.canvas=document.getElementById(b);var a=this;$("[data-color]").off("click").on("click",function(){a.color=$(this).attr("data-color");a.pencil.color=$(this).attr("data-color")});$("[data-size]").off("click").on("click",function(){a.size=$(this).attr("data-size");a.pencil.size=$(this).attr("data-size")});this.canvas.width=1920;this.canvas.height=1080;this.canvas.style.width=1920;this.canvas.style.height=1080;this.lastSend=new Date().getTime();this.color="#000000";this.size=10;var c=1;if($("#"+b).width()>$("#"+b).height()){if($("#"+b).width()>window.innerWidth){c=window.innerWidth/$("#"+b).width()}else{c=$("#"+b).width()/window.innerWidth}}else{if($("#"+b).height()>window.innerHeight){c=$("#"+b).height()/window.innerHeight}else{c=window.innerHeight/$("#"+b).height()}}$("#"+b).css({transform:"scale("+c+")"});this.pencil={color:this.color,size:this.size,stylingW:"round",stylingH:"round"};this.stage=new createjs.Stage(b);this.stage.autoClear=true;this.stage.update();this.touchPos={x:0,y:0};this.isMouseDown=false;this.currentShape=[];createjs.Ticker.setFPS(60);createjs.Ticker.addEventListener("tick",$.proxy(function(){this.update()},this))};drawer.prototype.set_pencil=function(a){$.each(_.keys(a),$.proxy(function(b,c){this.pencil[c]=a[c]},this))};drawer.prototype.init=function(){console.log("drawer inited");this.create_events()};drawer.prototype.create_events=function(){createjs.Touch.enable(this.stage);this.stage.on("stagemousedown",$.proxy(function(a){this.isMouseDown=true;var c=new createjs.Shape();if("ontouchstart" in window){this.oldX=a.stageX;this.oldY=a.stageY;this.oldMidX=a.stageX;this.oldMidY=a.stageY;this.touchPos={x:a.stageX,y:a.stageY}}else{this.oldX=this.stage.mouseX;this.oldY=this.stage.mouseY;this.oldMidX=this.stage.mouseX;this.oldMidY=this.stage.mouseY}var d=c.graphics;d.setStrokeStyle(10,"round","round");var b=createjs.Graphics.getRGB(0,0,0);d.beginStroke(this.pencil.color);this.stage.addChild(c);this.currentShape[this.currentShape.length]=c;app.socket.emit("njoy",{status:"drawing_point",x:this.oldX,y:this.oldY})},this));this.stage.on("stagemousemove",$.proxy(function(a){this.touchPos={x:a.stageX,y:a.stageY}},this));this.stage.on("stagemouseup",$.proxy(function(a){this.isMouseDown=false},this))};drawer.prototype.update=function(){if(this.isMouseDown){if(this.touchPos!==null){var a=new createjs.Point(this.touchPos.x,this.touchPos.y)}else{var a=new createjs.Point(this.stage.mouseX,this.stage.mouseY)}var b=new createjs.Point(this.oldX+a.x>>1,this.oldY+a.y>>1);if(typeof this.currentShape[this.currentShape.length-1]!="undefined"){this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(this.pencil.size,this.pencil.stylingW,this.pencil.stylingH);this.currentShape[this.currentShape.length-1].graphics.moveTo(b.x,b.y);this.currentShape[this.currentShape.length-1].graphics.curveTo(this.oldX,this.oldY,this.oldMidX,this.oldMidY)}this.oldX=a.x;this.oldY=a.y;this.oldMidX=b.x;this.oldMidY=b.y;this.stage.update();this._removed=[];if(new Date().getTime()-this.lastSend>50){app.socket.emit("njoy",{status:"drawing",color:createjs.Graphics.getRGB(0,0,0),strokestyle:{size:this.pencil.size,stylingH:this.pencil.stylingH,stylingW:this.pencil.stylingW},type:"moveTo",x:b.x,y:b.y,curve:{oldX:this.oldX,oldY:this.oldY,oldMidX:this.oldMidX,oldMidY:this.oldMidY}});this.lastSend=new Date().getTime()}}};drawer.prototype.cancel=function(){};drawer.prototype.clear=function(){};drawer.prototype.destroy=function(){};
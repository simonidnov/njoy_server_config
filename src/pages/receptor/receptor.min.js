var receptor={currentShape:[],canvas:null,init:function(){console.log("--------------------------- INIT RECEPTOR"),app.init(function(){}),app.socket_callback=$.proxy(function(e){console.log(e),"undefined"!=typeof e.datas?(this.create_component(e.datas),"undefined"!=typeof e.datas.tools&&("undefined"!=typeof e.datas.tools.logo&&$(".app_logo").css("background-image","url("+e.datas.tools.icon+")"),"undefined"!=typeof e.datas.tools.icon&&$(".app_icon").css("background-image","url("+e.datas.tools.logo+")"))):$(".app_icon, .app_logo").css("background-image","url()")},this)},create_component:function(e){switch($(".receptor .module").css({"transform-origin":"50% 50%",overflow:"hidden",width:window.innerWidth+"px",height:window.innerHeight+"px","border-radius":"0",position:"relative"}),$(".chronos").remove(),$("video").length>0&&($(".module").children().filter("video").each(function(){this.pause(),delete this,$(this).remove()}),$(".module").empty()),$(".app_logo, .app_icon").css("display","block"),e.status){case"init_drawing":$(".module").html(""),$(".chronos").remove(),$(".receptor").css({"background-image":"url()","background-color":"#FFF"}),TweenMax.killAll(),this.init_drawing(e);break;case"drawing":this.drawing(e);break;case"drawing_point":this.drawing_point(e);break;case"video":$(".app_logo, .app_icon").css("display","none"),$(".module").html(""),$(".chronos").remove(),TweenMax.killAll(),$(".receptor").css({"background-image":"url("+(window.location.origin+"/"+e.file.replace(".mp4",".svg"))+")","background-size":"cover"});break;case"force_video":$(".app_logo, .app_icon").css("display","none"),$(".module").html(""),$(".chronos").remove(),TweenMax.killAll(),console.log("add video display"),$(".module").append('<div class="video_display"><video src="'+window.location.origin+"/"+e.file+'" autoplay width="'+window.innerWidth+'px" height="'+window.innerHeight+'px"></video></div>');break;case"playlist_video":$(".module").append('<div class="video_display"></div>'),TweenMax.killAll(),console.log("play video playlist");break;case"audio":TweenMax.killAll(),"undefined"!=typeof this.audio&&this.audio.pause(),this.audio=new Audio(e.file),this.audio.play(),console.log("play audio http://10.213.1.231:3000/",e.file);break;case"playlist_audio":$(".module").append('<div class="audio_display"></div>'),TweenMax.killAll(),console.log("play audio playlist");break;case"picture":$(".module").html(""),TweenMax.killAll(),$(".module").append('<div class="picture_display"></div>'),$(".picture_display").css("background-image","url("+e.file+")"),console.log("display picture");break;case"":break;case"success":this.success(e),console.log("this is success");break;case"display_text":this.display_text("DISPLAY TEXT"),console.log("display_text");case"fail":this.fail(e),console.log("this is fail");break;case"object":this.object_component(e);break;case"golden_family":this.golden_family(e);break;case"web_content":this.web_content(e)}"undefined"!=typeof e.chronos&&this.setChronos(e.chronos,e.chronos_type)},web_content:function(e){console.log(e)},object_component:function(e){switch($(".module").html(""),$(".chronos").remove(),TweenMax.killAll(),e.component){case"quiz_component":break;case"golden_family":$(".module").append('<div class="golden_family"><div class="content_choice"><h3>'+e.tools.menu[e.menu].components.golden_family[e.component_id].desc+'</h3><ul class="choices"></ul></div></div>');for(var s=e.tools.menu[e.menu].components.golden_family[e.component_id].choices.length,o=0;s>o;o++)$(".receptor .module .golden_family ul.choices").append('<li><div class="front"></div><div class="back">'+e.tools.menu[e.menu].components.golden_family[e.component_id].choices[o]+'<div class="points">'+(10*s-10*o)+"</div></div></li>")}},golden_family:function(e){"undefined"!=typeof e.response&&$(".receptor .module .golden_family ul.choices li").eq(parseInt(e.response)).addClass("selected")},setChronos:function(e,s){"undefined"==typeof s&&(s="bottom"),$(".screen.receptor").append('<div class="chronos '+s+'"><div class="counter"></div><div class="timelap"><div class="progress"></div></div></div>'),$(".chronos .counter").html(e);var o=TweenMax.to($(".timelap .progress"),parseInt(e),{css:{width:"100%"},ease:Linear.easeNone,onUpdate:function(s){$(".chronos .counter").html(parseInt(e)-Math.round(o.time()))},onComplete:function(){}})},success:function(){TweenMax.killAll(),$("#error_motion").remove(),$("#success_motion").remove(),$(".receptor").css({"background-color":"#3B0092","background-image":"url()"}),$(".receptor .module").css({position:"absolute",width:window.innerWidth+"px",height:window.innerWidth+"px","transform-origin":"50% 50%",overflow:"hidden",top:0,left:0,right:0,bottom:0,margin:"auto"}),TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"100%",width:"0px",height:"0px"}});var e=_.template($("#success_template").html());$(".receptor").append(e({label:"BRAVO!"})),$.each($(".confetti"),function(e,s){var o=1*Math.random()+.5;TweenMax.to($(this),2.8,{css:{top:Math.round(-window.innerHeight+Math.random()*(2*window.innerHeight))+"px",left:Math.round(-window.innerWidth+Math.random()*(2*window.innerWidth))+"px",rotation:360*Math.random(),scaleX:o,scaleY:o},ease:Power4.easeOut,delay:.5})}),TweenMax.set($(".success_text"),{scaleX:0,scaleY:0}),"undefined"!=typeof this.audio&&this.audio.pause(),this.audio=new Audio("ressources/audio/applau.mp3"),this.audio.play(),TweenMax.to($(".success_text"),.5,{scaleX:1,scaleY:1,ease:Elastic.easeOut,delay:.8,onComplete:function(){TweenMax.to($(".success_text"),.8,{scaleX:0,scaleY:0,delay:.8,ease:Back.easeIn,onComplete:function(){TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"0%",width:window.innerWidth+"px",height:window.innerHeight+"px"},ease:Power4.easeIn,onComplete:function(){$("#success_motion").remove()}})}}),$.each($(".confetti"),function(e,s){TweenMax.to($(this),.6,{css:{top:$(this).position().top+2*window.innerHeight+"px",rotation:360*Math.random()},ease:Power4.easeIn,delay:.03*e})})}})},fail:function(){TweenMax.killAll(),$("#error_motion").remove(),$("#success_motion").remove(),$(".receptor").css({"background-color":"#FF6633","background-image":"url()"}),$(".receptor .module").css({position:"absolute",width:window.innerWidth+"px",height:window.innerWidth+"px","transform-origin":"50% 50%",overflow:"hidden",top:0,left:0,right:0,bottom:0,margin:"auto"}),TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"100%",width:"0px",height:"0px"}});var e=_.template($("#error_template").html());$(".receptor").append(e({})),TweenMax.set($(".success_text"),{scaleX:0,scaleY:0}),TweenMax.to($(".success_text"),.5,{scaleX:1,scaleY:1,ease:Elastic.easeOut,delay:.8,onComplete:function(){"undefined"!=typeof this.audio&&this.audio.pause(),this.audio=new Audio("ressources/audio/faux.mp3"),this.audio.play(),TweenMax.to($(".success_text"),.8,{scaleX:0,scaleY:0,delay:.8,ease:Back.easeIn,onComplete:function(){TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"0%",width:window.innerWidth+"px",height:window.innerHeight+"px"},ease:Power4.easeIn,onComplete:function(){$("#success_motion").remove()}})}})}})},display_text:function(e){TweenMax.killAll(),$("#success_motion").remove(),$(".receptor").css({"background-color":"#3B0092","background-image":"url()"}),$(".receptor .module").css({position:"absolute",width:window.innerWidth+"px",height:window.innerWidth+"px","transform-origin":"50% 50%",overflow:"hidden",top:0,left:0,right:0,bottom:0,margin:"auto"}),TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"100%",width:"0px",height:"0px"}});var s=_.template($("#success_template").html());$(".receptor").append(s({label:e})),$.each($(".confetti"),function(e,s){var o=1*Math.random()+.5;TweenMax.to($(this),2.8,{css:{top:Math.round(-window.innerHeight+Math.random()*(2*window.innerHeight))+"px",left:Math.round(-window.innerWidth+Math.random()*(2*window.innerWidth))+"px",rotation:360*Math.random(),scaleX:o,scaleY:o},ease:Power4.easeOut,delay:.5})}),TweenMax.set($(".success_text"),{scaleX:0,scaleY:0}),TweenMax.to($(".success_text"),.5,{scaleX:1,scaleY:1,ease:Elastic.easeOut,delay:.8,onComplete:function(){TweenMax.to($(".success_text"),.8,{scaleX:0,scaleY:0,delay:.8,ease:Back.easeIn,onComplete:function(){TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"0%",width:window.innerWidth+"px",height:window.innerHeight+"px"},ease:Power4.easeIn,onComplete:function(){$("#success_motion").remove()}})}}),$.each($(".confetti"),function(e,s){TweenMax.to($(this),.6,{css:{top:$(this).position().top+2*window.innerHeight+"px",rotation:360*Math.random()},ease:Power4.easeIn,delay:.03*e})})}})},init_drawing:function(e){console.log("init_drawing"),$(".module").append('<canvas id="drawing" width="'+e.width+'" height="'+e.height+'" style="width:'+e.width+"px; height:"+e.height+'px;"></canvas>'),this.canvas=document.getElementById("drawing"),this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.style.width=e.width,this.canvas.style.height=e.height,$("#drawing").css({width:e.width+"px !important",height:e.height+"px !important"}),this.stage=new createjs.Stage("drawing"),this.currentShape=[];var s=new createjs.Shape;this.currentShape[0]=s;var o=s.graphics;o.beginStroke("#000000"),this.stage.addChild(s),this.stage.autoClear=!0,this.stage.update()},drawing_point:function(e){console.log("drawing_point with new shape then set oldX Y enstroke",e.x),this.oldX=e.x,this.oldY=e.y,this.currentShape[this.currentShape.length-1].graphics.endStroke().endFill();var s=new createjs.Shape;this.currentShape[this.currentShape.length]=s;var o=s.graphics;o.beginStroke("#000000"),this.stage.addChild(s),o.moveTo(e.x,e.y)},drawing:function(e){console.log(this.oldX);var s=new createjs.Point(e.x,e.y),o=new createjs.Point(this.oldX+s.x>>1,this.oldY+s.y>>1);"undefined"!=typeof this.currentShape[this.currentShape.length-1]&&(this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(e.strokestyle.size,e.strokestyle.stylingW,e.strokestyle.stylingH),this.currentShape[this.currentShape.length-1].graphics.moveTo(o.x,o.y),this.currentShape[this.currentShape.length-1].graphics.curveTo(this.oldX,this.oldY,this.oldMidX,this.oldMidY)),this.oldX=s.x,this.oldY=s.y,this.oldMidX=o.x,this.oldMidY=o.y,this.stage.update()},destroy:function(){console.log("destroy receptor")}},drawer=function(e,s,o){this.canvas=document.getElementById(e),this.canvas.width=s,this.canvas.height=o,this.canvas.style.width=s,this.canvas.style.height=o,$("#canvas_id").css({width:$("body").width()+"px !important",height:$("body").height()+"px !important"}),this.stage=new createjs.Stage(e),this.stage.autoClear=!0,this.stage.update(),this.currentShape=[];var t=new createjs.Shape;this.currentShape[0]=t;var i=t.graphics;i.beginStroke("#000000"),this.stage.addChild(t)};
var receptor={currentShape:[],canvas:null,init:function(){app.init(function(){});app.socket_callback=$.proxy(function(a){console.log(a);if(typeof a.datas!=="undefined"){this.create_component(a.datas);if(typeof a.datas.tools!=="undefined"){if(typeof a.datas.tools.logo!=="undefined"){$(".app_logo").css("background-image","url("+a.datas.tools.icon+")")}if(typeof a.datas.tools.icon!=="undefined"){$(".app_icon").css("background-image","url("+a.datas.tools.logo+")")}}}else{$(".app_icon, .app_logo").css("background-image","url()")}},this);if(localStorage.getItem("video")!==null||localStorage.getItem("video")!==""){this.create_component(JSON.parse(localStorage.getItem("video")))}},create_component:function(a){$(".chronos").remove();if($("video").length>0){$(".module").children().filter("video").each(function(){this.pause();delete this;$(this).remove()});$(".module").empty()}$(".app_logo, .app_icon").css("display","block");switch(a.status){case"init_drawing":$(".module").html("");$(".chronos").remove();TweenMax.killAll();this.init_drawing(a);break;case"drawing":this.drawing(a);break;case"drawing_point":this.drawing_point(a);break;case"video":if(localStorage.getItem("video")==null||localStorage.getItem("video")==""){console.log(localStorage.getItem("video"));alert("has vodeo");localStorage.setItem("video",JSON.stringify(a));window.location.reload()}else{localStorage.setItem("video","")}$(".app_logo, .app_icon").css("display","none");$(".module").html("");$(".chronos").remove();TweenMax.killAll();$(".module").append('<div class="video_display"><video src="'+window.location.origin+"/"+a.file+'" autoplay width="'+window.innerWidth+'px" height="'+window.innerHeight+'px"></video></div>');break;case"playlist_video":$(".module").append('<div class="video_display"></div>');TweenMax.killAll();console.log("play video playlist");break;case"audio":TweenMax.killAll();if(typeof this.audio!=="undefined"){this.audio.pause()}this.audio=new Audio(a.file);this.audio.play();console.log("play audio http://10.213.1.231:3000/",a.file);break;case"playlist_audio":$(".module").append('<div class="audio_display"></div>');TweenMax.killAll();console.log("play audio playlist");break;case"picture":$(".module").html("");TweenMax.killAll();$(".module").append('<div class="picture_display"></div>');$(".picture_display").css("background-image","url("+a.file+")");console.log("display picture");break;case"":break;case"success":this.success(a);console.log("this is success");break;case"fail":this.fail(a);console.log("this is fail");break;case"object":this.object_component(a);break;case"golden_family":this.golden_family(a);break;case"web_content":this.web_content(a);break}if(typeof a.chronos!=="undefined"){this.setChronos(a.chronos,a.chronos_type)}},web_content:function(a){console.log(a)},object_component:function(a){$(".module").html("");$(".chronos").remove();TweenMax.killAll();switch(a.component){case"quiz_component":break;case"golden_family":$(".module").append('<div class="golden_family"><div class="content_choice"><h3>'+a.tools.menu[a.menu].components.golden_family[a.component_id].desc+'</h3><ul class="choices"></ul></div></div>');var c=a.tools.menu[a.menu].components.golden_family[a.component_id].choices.length;for(var b=0;b<c;b++){$(".receptor .module .golden_family ul.choices").append('<li><div class="front"></div><div class="back">'+a.tools.menu[a.menu].components.golden_family[a.component_id].choices[b]+'<div class="points">'+((c*10)-(b*10))+"</div></div></li>")}break}},golden_family:function(a){if(typeof a.response!=="undefined"){$(".receptor .module .golden_family ul.choices li").eq(parseInt(a.response)).addClass("selected")}},setChronos:function(c,b){if(typeof b==="undefined"){b="bottom"}$(".screen.receptor").append('<div class="chronos '+b+'"><div class="counter"></div><div class="timelap"><div class="progress"></div></div></div>');$(".chronos .counter").html(c);var a=TweenMax.to($(".timelap .progress"),parseInt(c),{css:{width:"100%"},ease:Linear.easeNone,onUpdate:function(d){$(".chronos .counter").html(parseInt(c)-Math.round(a.time()))},onComplete:function(){}})},success:function(){if($(".motion_canvas").length==0){$(".module").append('<iframe class="motion_canvas" id="motion_canvas" style="width:1920px; height:1080px; border:none; padding:0; margin:0;" src="/ressources/animations/success.html"></iframe')}if(typeof this.conf!=="undefined"){delete this.conf}},fail:function(){$(".module").append('<canvas class="motion_canvas" id="motion_canvas"></canvas')},init_drawing:function(a){console.log("init_drawing");$(".module").append('<canvas id="drawing" width="'+a.width+'" height="'+a.height+'"></canvas>');this.canvas=document.getElementById("drawing");this.canvas.width=a.width;this.canvas.height=a.height;this.canvas.style.width=window.innerWidth;this.canvas.style.height=window.innerHeight;$("#canvas_id").css({width:$("body").width()+"px !important",height:$("body").height()+"px !important"});this.stage=new createjs.Stage("drawing");this.stage.autoClear=true;this.stage.update();this.currentShape=[];var b=new createjs.Shape();this.currentShape[0]=b;var c=b.graphics;c.beginStroke("#000000");this.stage.addChild(b);this.stage.autoClear=true;this.stage.update()},drawing_point:function(a){console.log("drawing_point with new shape then set oldX Y enstroke",a.x);this.oldX=a.x;this.oldY=a.y;this.currentShape[this.currentShape.length-1].graphics.endStroke().endFill();var b=new createjs.Shape();this.currentShape[this.currentShape.length]=b;var c=b.graphics;c.beginStroke("#000000");this.stage.addChild(b);c.moveTo(a.x,a.y)},drawing:function(a){console.log(this.oldX);var b=new createjs.Point(a.x,a.y);var c=new createjs.Point(this.oldX+b.x>>1,this.oldY+b.y>>1);if(typeof this.currentShape[this.currentShape.length-1]!="undefined"){this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(a.strokestyle.size,a.strokestyle.stylingW,a.strokestyle.stylingH);this.currentShape[this.currentShape.length-1].graphics.moveTo(c.x,c.y);this.currentShape[this.currentShape.length-1].graphics.curveTo(this.oldX,this.oldY,this.oldMidX,this.oldMidY)}this.oldX=b.x;this.oldY=b.y;this.oldMidX=c.x;this.oldMidY=c.y;this.stage.update()},destroy:function(){console.log("destroy receptor")}};var drawer=function(b,d,a){this.canvas=document.getElementById(b);this.canvas.width=d;this.canvas.height=a;this.canvas.style.width=d;this.canvas.style.height=a;$("#canvas_id").css({width:$("body").width()+"px !important",height:$("body").height()+"px !important"});this.stage=new createjs.Stage(b);this.stage.autoClear=true;this.stage.update();this.currentShape=[];var c=new createjs.Shape();this.currentShape[0]=c;var e=c.graphics;e.beginStroke("#000000");this.stage.addChild(c)};
var receptor={currentShape:[],canvas:null,init:function(){app.init(function(){});app.socket_callback=$.proxy(function(a){if(typeof a.datas!=="undefined"){this.create_component(a.datas);if(typeof a.datas.tools!=="undefined"){if(typeof a.datas.tools.tr!=="undefined"){$(".tr").css("background-image","url("+a.datas.tools.tr+")")}else{$(".tr").css("background-image","none")}if(typeof a.datas.tools.tl!=="undefined"){$(".tl").css("background-image","url("+a.datas.tools.tl+")")}else{$(".tl").css("background-image","url()")}if(typeof a.datas.tools.tc!=="undefined"){$(".tc").css("background-image","url("+a.datas.tools.tc+")")}else{$(".tc").css("background-image","url()")}if(typeof a.datas.tools.br!=="undefined"){$(".br").css("background-image","url("+a.datas.tools.br+")")}else{$(".br").css("background-image","url()")}if(typeof a.datas.tools.bl!=="undefined"){$(".bl").css("background-image","url("+a.datas.tools.bl+")")}else{$(".bl").css("background-image","url()")}if(typeof a.datas.tools.bc!=="undefined"){$(".bc").css("background-image","url("+a.datas.tools.bc+")")}else{$(".bc").css("background-image","url()")}if(typeof a.datas.tools.background!=="undefined"){$(".receptor").css({"background-image":"url("+a.datas.tools.background+")","background-size":"cover"})}else{$(".receptor").css({"background-image":"url()","background-size":"contain"})}}}else{$(".tr").css("background-image","none");$(".tc").css("background-image","none");$(".tl").css("background-image","none");$(".br").css("background-image","none");$(".bc").css("background-image","none");$(".bl").css("background-image","none");$(".module").html("").empty()}},this)},create_component:function(a){$(".receptor .module").css({"transform-origin":"50% 50%",overflow:"hidden",width:window.innerWidth+"px",height:window.innerHeight+"px","border-radius":"0",position:"relative"});$(".chronos").remove();if($("video").length>0){$(".module").children().filter("video").each(function(){this.pause();delete this;$(this).remove()});$(".module").empty()}$(".tr, .tc, .tl, .br, .bc, .bl").css("display","block");switch(a.status){case"init_drawing":$(".module").html("");$(".chronos").remove();$(".receptor").css({"background-image":"url()","background-color":"#FFF"});TweenMax.killAll();this.init_drawing(a);break;case"drawing":this.drawing(a);break;case"drawing_point":this.drawing_point(a);break;case"drawing_clear":this.drawing_clear(a);break;case"video":$(".app_logo, .app_icon").css("display","none");$(".module").html("");$(".chronos").remove();TweenMax.killAll();if(typeof this.audio!=="undefined"){this.audio.pause();app.socket.emit("njoy",{status:"audio_stopped"})}break;case"force_video":$(".app_logo, .app_icon").css("display","none");$(".module").html("");$(".chronos").remove();TweenMax.killAll();$(".module").append('<div class="video_display"><video src="'+window.location.origin+"/"+a.file+'" autoplay width="'+window.innerWidth+'px" height="'+window.innerHeight+'px"></video></div>');break;case"playlist_video":$(".module").append('<div class="video_display"></div>');TweenMax.killAll();break;case"FX":console.log(a);$(".module").append('<div class="fx" style="background-image:url('+a.data+')"></div>');TweenMax.to($(".fx"),0.5,{css:{top:0},ease:Back.easeOut});this.fx=new Audio(a.file);this.fx.play();this.fx.addEventListener("ended",function(){TweenMax.to($(".fx"),0.5,{css:{top:"100%"},ease:Back.easeIn,onComplete:function(){$(".fx").remove()}})});break;case"audio":TweenMax.killAll();if(typeof this.audio!=="undefined"){this.audio.pause()}this.audio=new Audio(a.file);this.audio.play();this.audio.addEventListener("ended",function(){app.socket.emit("njoy",{status:"audio_stopped"})});app.socket.emit("njoy",{status:"audio_played"});break;case"audio_pause":if(typeof this.audio!=="undefined"){this.audio.pause()}app.socket.emit("njoy",{status:"audio_paused"});break;case"audio_resume":if(typeof this.audio!=="undefined"){this.audio.play()}app.socket.emit("njoy",{status:"audio_play"});break;case"audio_mute":if(typeof this.audio!=="undefined"){this.audio.volume=0}app.socket.emit("njoy",{status:"audio_muted"});break;case"audio_volume":if(typeof this.audio!=="undefined"){this.audio.volume=1}app.socket.emit("njoy",{status:"audio_volumed"});break;case"audio_stop":if(typeof this.audio!=="undefined"){this.audio.pause()}app.socket.emit("njoy",{status:"audio_stopped"});break;case"playlist_audio":$(".module").append('<div class="audio_display"></div>');TweenMax.killAll();break;case"picture":$(".module").html("");TweenMax.killAll();$(".module").append('<div class="picture_display"></div>');$(".picture_display").css("background-image","url("+a.file+")");break;case"":break;case"success":break;case"display_text":this.display_text("DISPLAY TEXT");case"fail":break;case"object":this.object_component(a);break;case"golden_family":this.golden_family(a);break;case"web_content":this.web_content(a);break}if(typeof a.teams!=="undefined"){app.teams=a.teams;this.set_teams(a.teams)}if(typeof a.chronos!=="undefined"){this.setChronos(a.chronos,a.chronos_type)}},set_teams:function(b){var a=_.template($("#teams_template").html());$("#teams_display").remove();if(b.length>0){$(".screen.receptor").append(a({teams:b}));$("#teams_display").css("display","block")}},web_content:function(a){},object_component:function(a){$(".module").html("");$(".chronos").remove();TweenMax.killAll();switch(a.component){case"quiz_component":break;case"golden_family":$(".module").append('<div class="golden_family"><div class="content_choice"><h3>'+a.tools.menu[a.menu].components.golden_family[a.component_id].desc+'</h3><ul class="choices"></ul></div></div>');var c=a.tools.menu[a.menu].components.golden_family[a.component_id].choices.length;for(var b=0;b<c;b++){$(".receptor .module .golden_family ul.choices").append('<li><div class="front"></div><div class="back">'+a.tools.menu[a.menu].components.golden_family[a.component_id].choices[b]+'<div class="points">'+((c*10)-(b*10))+"</div></div></li>")}break}},golden_family:function(a){if(typeof a.response!=="undefined"){$(".receptor .module .golden_family ul.choices li").eq(parseInt(a.response)).addClass("selected")}},setChronos:function(c,b){if(typeof b==="undefined"){b="bottom"}$(".screen.receptor").append('<div class="chronos '+b+'"><div class="counter"></div><div class="timelap"><div class="progress"></div></div></div>');$(".chronos .counter").html(c);var a=TweenMax.to($(".timelap .progress"),parseInt(c),{css:{width:"100%"},ease:Linear.easeNone,onUpdate:function(d){$(".chronos .counter").html(parseInt(c)-Math.round(a.time()))},onComplete:function(){}})},success:function(){TweenMax.killAll();$(".over_motion").remove();var a=_.template($("#success_template").html());$(".receptor").append(a());if(typeof this.audio!=="undefined"){this.audio.pause()}this.audio=new Audio("ressources/audio/applau.mp3");this.audio.play()},fail:function(){TweenMax.killAll();$(".over_motion").remove();var a=_.template($("#success_template").html());$(".receptor").append(a());if(typeof this.audio!=="undefined"){this.audio.pause()}this.audio=new Audio("ressources/audio/faux.mp3");this.audio.play()},display_text:function(a){TweenMax.killAll();$("#success_motion").remove();$(".receptor .module").css({position:"absolute",width:window.innerWidth+"px",height:window.innerWidth+"px","transform-origin":"50% 50%",overflow:"hidden",top:0,left:0,right:0,bottom:0,margin:"auto"});TweenMax.to($(".receptor .module"),0.5,{css:{"border-radius":"100%",width:"0px",height:"0px"}});var b=_.template($("#success_template").html());$(".receptor").append(b({label:a}));$.each($(".confetti"),function(d,c){var e=Math.random()*1+0.5;TweenMax.to($(this),2.8,{css:{top:Math.round((-window.innerHeight)+Math.random()*(window.innerHeight*2))+"px",left:Math.round((-window.innerWidth)+Math.random()*(window.innerWidth*2))+"px",rotation:Math.random()*360,scaleX:e,scaleY:e},ease:Power4.easeOut,delay:0.5})});TweenMax.set($(".success_text"),{scaleX:0,scaleY:0});TweenMax.to($(".success_text"),0.5,{scaleX:1,scaleY:1,ease:Elastic.easeOut,delay:0.8,onComplete:function(){TweenMax.to($(".success_text"),0.8,{scaleX:0,scaleY:0,delay:0.8,ease:Back.easeIn,onComplete:function(){TweenMax.to($(".receptor .module"),0.5,{css:{"border-radius":"0%",width:window.innerWidth+"px",height:window.innerHeight+"px"},ease:Power4.easeIn,onComplete:function(){$("#success_motion").remove()}})}});$.each($(".confetti"),function(d,c){TweenMax.to($(this),0.6,{css:{top:($(this).position().top+(window.innerHeight*2))+"px",rotation:Math.random()*360},ease:Power4.easeIn,delay:(0.03*d)})})}})},init_drawing:function(a){console.log("init_drawing ",a.width);$(".module").append('<canvas id="drawing" width="'+a.width+'" height="'+a.height+'" style="width:'+a.width+"px; height:"+a.height+'px;"></canvas>');this.canvas=document.getElementById("drawing");this.canvas.width=a.width;this.canvas.height=a.height;this.canvas.style.width=a.width;this.canvas.style.height=a.height;var e=1,b="drawing";if($("#"+b).width()>$("#"+b).height()){if($("#"+b).width()>window.innerWidth){e=window.innerWidth/$("#"+b).width()}else{e=$("#"+b).width()/window.innerWidth}}else{if($("#"+b).height()>window.innerHeight){e=$("#"+b).height()/window.innerHeight}else{e=window.innerHeight/$("#"+b).height()}}$("#drawing").css({width:a.width+"px !important",height:a.height+"px !important",transform:"scale("+e+")"});this.stage=new createjs.Stage("drawing");this.currentShape=[];var c=new createjs.Shape();this.currentShape[0]=c;var d=c.graphics;d.beginStroke("#000000");this.stage.addChild(c);this.stage.autoClear=true;this.stage.update()},drawing_clear:function(){this.stage.removeAllChildren();this.stage.update()},drawing_point:function(a){this.oldX=a.x;this.oldY=a.y;this.currentShape[this.currentShape.length-1].graphics.endStroke();this.currentShape[this.currentShape.length-1].graphics.endFill();var b=new createjs.Shape();this.currentShape[this.currentShape.length]=b;var c=b.graphics;this.stage.addChild(b);this.drawing(a)},drawing:function(a){console.log(a);var b=new createjs.Point(a.x,a.y);var c=new createjs.Point(this.oldX+b.x>>1,this.oldY+b.y>>1);if(typeof this.currentShape[this.currentShape.length-1]!="undefined"){if(typeof a.strokestyle!=="undefined"){this.currentShape[this.currentShape.length-1].graphics.beginStroke(a.color);this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(a.strokestyle.size,a.strokestyle.stylingW,a.strokestyle.stylingH)}else{console.log("stroke none");this.currentShape[this.currentShape.length-1].graphics.beginStroke("rgba(0,0,0,0)");this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(0,0,0)}this.currentShape[this.currentShape.length-1].graphics.moveTo(c.x,c.y);this.currentShape[this.currentShape.length-1].graphics.curveTo(this.oldX,this.oldY,this.oldMidX,this.oldMidY)}this.oldX=b.x;this.oldY=b.y;this.oldMidX=c.x;this.oldMidY=c.y;this.stage.update()},destroy:function(){console.log("destroy receptor")}};var drawer=function(b,d,a){this.canvas=document.getElementById(b);this.canvas.width=d;this.canvas.height=a;this.canvas.style.width=d;this.canvas.style.height=a;$("#canvas_id").css({width:$("body").width()+"px !important",height:$("body").height()+"px !important"});this.stage=new createjs.Stage(b);this.stage.autoClear=true;this.stage.update();this.currentShape=[];var c=new createjs.Shape();this.currentShape[0]=c;var e=c.graphics;e.beginStroke("#000000");this.stage.addChild(c)};
var receptor={currentShape:[],canvas:null,init:function(){app.init(function(){}),app.socket_callback=$.proxy(function(e){void 0!==e.datas?(this.create_component(e.datas),void 0!==e.datas.tools&&(void 0!==e.datas.tools.tr?$(".tr").css("background-image","url("+e.datas.tools.tr+")"):$(".tr").css("background-image","none"),void 0!==e.datas.tools.tl?$(".tl").css("background-image","url("+e.datas.tools.tl+")"):$(".tl").css("background-image","url()"),void 0!==e.datas.tools.tc?$(".tc").css("background-image","url("+e.datas.tools.tc+")"):$(".tc").css("background-image","url()"),void 0!==e.datas.tools.br?$(".br").css("background-image","url("+e.datas.tools.br+")"):$(".br").css("background-image","url()"),void 0!==e.datas.tools.bl?$(".bl").css("background-image","url("+e.datas.tools.bl+")"):$(".bl").css("background-image","url()"),void 0!==e.datas.tools.bc?$(".bc").css("background-image","url("+e.datas.tools.bc+")"):$(".bc").css("background-image","url()"),void 0!==e.datas.tools.background?$(".receptor").css({"background-image":"url("+e.datas.tools.background+")","background-size":"cover"}):$(".receptor").css({"background-image":"url()","background-size":"contain"}))):($(".tr").css("background-image","none"),$(".tc").css("background-image","none"),$(".tl").css("background-image","none"),$(".br").css("background-image","none"),$(".bc").css("background-image","none"),$(".bl").css("background-image","none"),$(".module").html("").empty())},this)},create_component:function(e){switch(console.log("create_component ",e),$(".receptor .module").css({"transform-origin":"50% 50%",overflow:"hidden",width:window.innerWidth+"px",height:window.innerHeight+"px","border-radius":"0",position:"relative"}),void 0!==receptor.chrono_sound&&receptor.chrono_sound.pause(),$("video").length>0&&$(".module").children().filter("video").each(function(){this.pause(),$(this).remove()}),$(".tr, .tc, .tl, .br, .bc, .bl").css("display","block"),e.status){case"splash":$(".module").html(""),$(".chronos").remove();break;case"init_drawing":$(".module").html(""),$(".chronos").remove(),$(".receptor").css({"background-image":"url()","background-color":"#FFF"}),TweenMax.killAll(),app.socket.emit("njoy",{status:"stop_video"}),app.socket.emit("njoy",{status:"stop_audio"}),setTimeout($.proxy(function(){this.init_drawing(e)},this),300);break;case"drawing":this.drawing(e);break;case"drawing_point":this.drawing_point(e);break;case"drawing_clear":this.drawing_clear(e);break;case"video":$(".app_logo, .app_icon").css("display","none"),console.log("video"),$(".module").html(""),$(".chronos").remove(),TweenMax.killAll(),void 0!==this.audio&&(this.audio.pause(),app.socket.emit("njoy",{status:"audio_stopped"}));break;case"force_video":console.log("force_video"),$(".app_logo, .app_icon").css("display","none"),$(".module").html(""),$(".chronos").remove(),TweenMax.killAll(),$(".module").append('<div class="video_display"><video src="'+window.location.origin+"/"+e.file+'" autoplay width="'+window.innerWidth+'px" height="'+window.innerHeight+'px"></video></div>');break;case"playlist_video":$(".module").append('<div class="video_display"></div>'),TweenMax.killAll();break;case"FX":$(".module").append('<div class="fx" style="background-image:url('+e.data+')"></div>'),TweenMax.to($(".fx"),.5,{css:{top:0},ease:Back.easeOut}),TweenMax.to($(".fx"),.5,{css:{top:"100%",delay:3},ease:Back.easeIn,onComplete:function(){$(".fx").remove()}});break;case"audio":case"audio_pause":case"audio_resume":case"audio_mute":case"audio_volume":case"audio_stop":break;case"playlist_audio":TweenMax.killAll();break;case"picture":$(".module").html(""),TweenMax.killAll(),$(".module").append('<div class="picture_display"></div>'),$(".picture_display").css("background-image","url("+e.file+")");break;case"":case"success":break;case"display_text":this.display_text("DISPLAY TEXT");case"fail":break;case"object":this.object_component(e);break;case"golden_family":this.golden_family(e);break;case"web_content":this.web_content(e)}void 0!==e.teams&&(app.teams=e.teams,this.set_teams(e.teams)),void 0!==e.chronos&&this.setChronos(e.chronos,e.chronos_type)},set_teams:function(e){var t=_.template($("#teams_template").html());$("#teams_display").remove(),e.length>0&&($(".screen.receptor").append(t({teams:e})),$("#teams_display").css("display","block"))},web_content:function(e){},object_component:function(e){switch(console.log("object_component ",object_component),$(".chronos").remove(),TweenMax.killAll(),e.component){case"quiz_component":break;case"golden_family":$(".module").append('<div class="golden_family"><div class="content_choice"><h3>'+e.tools.menu[e.menu].components.golden_family[e.component_id].desc+'</h3><ul class="choices"></ul></div></div>');for(var t=e.tools.menu[e.menu].components.golden_family[e.component_id].choices.length,i=0;i<t;i++)$(".receptor .module .golden_family ul.choices").append('<li><div class="front"></div><div class="back">'+e.tools.menu[e.menu].components.golden_family[e.component_id].choices[i]+'<div class="points">'+(10*t-10*i)+"</div></div></li>")}},golden_family:function(e){void 0!==e.response&&$(".receptor .module .golden_family ul.choices li").eq(parseInt(e.response)).addClass("selected")},setChronos:function(e,t){void 0===t&&(t="bottom"),$(".screen.receptor").append('<div class="chronos '+t+'"><div class="counter"></div><div class="timelap"><div class="progress"></div></div></div>'),$(".chronos .counter").html(e);var i=TweenMax.to($(".timelap .progress"),parseInt(e),{css:{width:"100%"},ease:Linear.easeNone,onUpdate:function(t){$(".chronos .counter").html(parseInt(e)-Math.round(i.time()))},onComplete:function(){}})},success:function(){TweenMax.killAll(),$(".over_motion").remove();var e=_.template($("#success_template").html());$(".receptor").append(e()),void 0!==this.audio&&this.audio.pause(),this.audio=new Audio("ressources/audio/applau.mp3"),this.audio.play()},fail:function(){TweenMax.killAll(),$(".over_motion").remove();var e=_.template($("#success_template").html());$(".receptor").append(e()),void 0!==this.audio&&this.audio.pause(),this.audio=new Audio("ressources/audio/faux.mp3"),this.audio.play()},display_text:function(e){TweenMax.killAll(),$("#success_motion").remove(),$(".receptor .module").css({position:"absolute",width:window.innerWidth+"px",height:window.innerWidth+"px","transform-origin":"50% 50%",overflow:"hidden",top:0,left:0,right:0,bottom:0,margin:"auto"}),TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"100%",width:"0px",height:"0px"}});var t=_.template($("#success_template").html());$(".receptor").append(t({label:e})),$.each($(".confetti"),function(e,t){var i=1*Math.random()+.5;TweenMax.to($(this),2.8,{css:{top:Math.round(-window.innerHeight+Math.random()*(2*window.innerHeight))+"px",left:Math.round(-window.innerWidth+Math.random()*(2*window.innerWidth))+"px",rotation:360*Math.random(),scaleX:i,scaleY:i},ease:Power4.easeOut,delay:.5})}),TweenMax.set($(".success_text"),{scaleX:0,scaleY:0}),TweenMax.to($(".success_text"),.5,{scaleX:1,scaleY:1,ease:Elastic.easeOut,delay:.8,onComplete:function(){TweenMax.to($(".success_text"),.8,{scaleX:0,scaleY:0,delay:.8,ease:Back.easeIn,onComplete:function(){TweenMax.to($(".receptor .module"),.5,{css:{"border-radius":"0%",width:window.innerWidth+"px",height:window.innerHeight+"px"},ease:Power4.easeIn,onComplete:function(){$("#success_motion").remove()}})}}),$.each($(".confetti"),function(e,t){TweenMax.to($(this),.6,{css:{top:$(this).position().top+2*window.innerHeight+"px",rotation:360*Math.random()},ease:Power4.easeIn,delay:.03*e})})}})},init_drawing:function(e){$(".module").append('<canvas id="drawing" width="'+e.width+'" height="'+e.height+'" style="width:'+e.width+"px; height:"+e.height+'px;"></canvas>'),this.canvas=document.getElementById("drawing"),this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.style.width=e.width,this.canvas.style.height=e.height;var t=1;t=$("#drawing").width()>$("#drawing").height()?$("#drawing").width()>window.innerWidth?window.innerWidth/$("#drawing").width():$("#drawing").width()/window.innerWidth:$("#drawing").height()>window.innerHeight?$("#drawing").height()/window.innerHeight:window.innerHeight/$("#drawing").height(),$("#drawing").css({width:e.width+"px !important",height:e.height+"px !important",transform:"scale("+t+")"}),this.stage=new createjs.Stage("drawing"),this.currentShape=[];var i=new createjs.Shape;this.currentShape[0]=i,i.graphics.beginStroke("#000000"),this.stage.addChild(i),this.stage.autoClear=!0,this.stage.update()},drawing_clear:function(){this.stage.removeAllChildren(),this.stage.update()},drawing_point:function(e){this.oldX=e.x,this.oldY=e.y,this.currentShape[this.currentShape.length-1].graphics.endStroke(),this.currentShape[this.currentShape.length-1].graphics.endFill();var t=new createjs.Shape;this.currentShape[this.currentShape.length]=t;t.graphics;this.stage.addChild(t),this.drawing(e)},drawing:function(e){var t=new createjs.Point(e.x,e.y),i=new createjs.Point(this.oldX+t.x>>1,this.oldY+t.y>>1);void 0!==this.currentShape[this.currentShape.length-1]&&(void 0!==e.strokestyle?(this.currentShape[this.currentShape.length-1].graphics.beginStroke(e.color),this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(e.strokestyle.size,e.strokestyle.stylingW,e.strokestyle.stylingH)):(this.currentShape[this.currentShape.length-1].graphics.beginStroke("rgba(0,0,0,0)"),this.currentShape[this.currentShape.length-1].graphics.setStrokeStyle(0,0,0)),this.currentShape[this.currentShape.length-1].graphics.moveTo(i.x,i.y),this.currentShape[this.currentShape.length-1].graphics.curveTo(this.oldX,this.oldY,this.oldMidX,this.oldMidY)),this.oldX=t.x,this.oldY=t.y,this.oldMidX=i.x,this.oldMidY=i.y,this.stage.update()},destroy:function(){}},drawer=function(e,t,i){this.canvas=document.getElementById(e),this.canvas.width=t,this.canvas.height=i,this.canvas.style.width=t,this.canvas.style.height=i,$("#canvas_id").css({width:$("body").width()+"px !important",height:$("body").height()+"px !important"}),this.stage=new createjs.Stage(e),this.stage.autoClear=!0,this.stage.update(),this.currentShape=[];var a=new createjs.Shape;this.currentShape[0]=a,a.graphics.beginStroke("#000000"),this.stage.addChild(a)};
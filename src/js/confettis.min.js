var canvas_confettis,ctx,W,H,mp=20,particles=[],angle=0,tiltAngle=0,confettiActive=true,animationComplete=true,deactivationTimerHandler,reactivationTimerHandler,animationHandler,_stopped=false;var confettis=function(){var n={colorOptions:["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"],colorIndex:0,colorIncrementer:0,colorThreshold:10,getColor:function(){if(this.colorIncrementer>=10){this.colorIncrementer=0;this.colorIndex++;if(this.colorIndex>=this.colorOptions.length){this.colorIndex=0}}this.colorIncrementer++;return this.colorOptions[this.colorIndex]}};function i(q){this.x=Math.random()*W;this.y=(Math.random()*H)-H;this.r=a(100,250);this.d=(Math.random()*mp)+50;this.color=q;this.tilt=Math.floor(Math.random()*10)-10;this.tiltAngleIncremental=(Math.random()*0.07)+0.05;this.tiltAngle=0;this.draw=function(){ctx.beginPath();ctx.lineWidth=this.r/2;ctx.strokeStyle=this.color;ctx.moveTo(this.x+this.tilt+(this.r/4),this.y);ctx.lineTo(this.x+this.tilt,this.y+this.tilt+(this.r/4));return ctx.stroke()}}this.initConfettis=function(q){p(q);b();f();$(window).resize(function(){W=window.innerWidth;H=window.innerHeight;canvas_confettis.width=W;canvas_confettis.height=H})};function b(){$("#stopButton").click(j);$("#startButton").click(g)}function p(q){canvas_confettis=document.getElementById(q);ctx=canvas_confettis.getContext("2d");W=window.innerWidth;H=window.innerHeight;canvas_confettis.width=W;canvas_confettis.height=H}function f(){particles=[];results=[];animationComplete=false;for(var q=0;q<mp;q++){var r=n.getColor();particles.push(new i(r))}d()}function c(){ctx.clearRect(0,0,W,H);var r=[];for(var q=0;q<mp;q++){(function(s){r.push(particles[s].draw())})(q)}m();return r}function a(r,q){return Math.floor(Math.random()*(q-r+1)+r)}function m(){var r=0;var s;angle+=0.01;tiltAngle+=0.1;for(var q=0;q<mp;q++){s=particles[q];if(animationComplete){return}if(!confettiActive&&s.y<-15){s.y=H+100;continue}l(s,q);if(s.y<=H){r++}h(s,q)}if(r===0){e()}}function h(r,q){if((r.x>W+20||r.x<-20||r.y>H)&&confettiActive){if(q%5>0||q%2==0){o(r,Math.random()*W,-10,Math.floor(Math.random()*10)-20)}else{if(Math.sin(angle)>0){o(r,-20,Math.random()*H,Math.floor(Math.random()*10)-20)}else{o(r,W+20,Math.random()*H,Math.floor(Math.random()*10)-20)}}}}function l(r,q){r.tiltAngle+=r.tiltAngleIncremental;r.y+=(Math.cos(angle+r.d)+3+r.r/2)/2;r.x+=Math.sin(angle);r.tilt=(Math.sin(r.tiltAngle-(q/3)))*15}function o(t,s,q,r){t.x=s;t.y=q;t.tilt=r}function d(){W=window.innerWidth;H=window.innerHeight;canvas_confettis.width=W;canvas_confettis.height=H;(function q(){if(animationComplete){return null}animationHandler=requestAnimFrame(q);return c()})()}function k(){clearTimeout(reactivationTimerHandler);clearTimeout(animationHandler)}this.start_confettis=function(){if(!confettiActive){g()}};this.stop_confettis=function(){j();_stopped=true};function j(){confettiActive=false;k()}function e(){animationComplete=true;if(ctx==undefined){return}ctx.clearRect(0,0,W,H)}function g(){k();e();reactivationTimerHandler=setTimeout(function(){confettiActive=true;animationComplete=false;f()},100)}window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(q){return window.setTimeout(q,1000/60)}})()};
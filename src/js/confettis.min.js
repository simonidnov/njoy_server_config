var canvas_confettis,ctx,W,H,mp=80,particles=[],angle=0,tiltAngle=0,confettiActive=!0,animationComplete=!0,deactivationTimerHandler,reactivationTimerHandler,animationHandler,_stopped=!1,confettis=function(){function t(e){this.x=Math.random()*W,this.y=Math.random()*H-H,this.r=a(10,100),this.d=Math.random()*mp+50,this.color=e,this.tilt=Math.floor(10*Math.random())-10,this.tiltAngleIncremental=.07*Math.random()+.05,this.tiltAngle=0,this.draw=function(){return ctx.beginPath(),ctx.lineWidth=this.r/2,ctx.strokeStyle=this.color,ctx.moveTo(this.x+this.tilt+this.r/4,this.y),ctx.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),ctx.stroke()}}function i(){$("#stopButton").click(f),$("#startButton").click(m)}function s(e){canvas_confettis=document.getElementById(e),ctx=canvas_confettis.getContext("2d"),W=window.innerWidth,H=window.innerHeight,canvas_confettis.width=W,canvas_confettis.height=H}function n(){particles=[],results=[],animationComplete=!1;for(var i=0;mp>i;i++){console.log(i);var s=e.getColor();particles.push(new t(s))}p()}function o(){ctx.clearRect(0,0,W,H);for(var e=[],t=0;mp>t;t++)!function(t){e.push(particles[t].draw())}(t);return r(),e}function a(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function r(){var t,e=0;angle+=.01,tiltAngle+=.1;for(var i=0;mp>i;i++){if(t=particles[i],animationComplete)return;!confettiActive&&t.y<-15?t.y=H+100:(l(t,i),t.y<=H&&e++,c(t,i))}0===e&&h()}function c(e,t){(e.x>W+20||e.x<-20||e.y>H)&&confettiActive&&(t%5>0||t%2==0?u(e,Math.random()*W,-10,Math.floor(10*Math.random())-20):Math.sin(angle)>0?u(e,-20,Math.random()*H,Math.floor(10*Math.random())-20):u(e,W+20,Math.random()*H,Math.floor(10*Math.random())-20))}function l(e,t){e.tiltAngle+=e.tiltAngleIncremental,e.y+=(Math.cos(angle+e.d)+3+e.r/2)/2,e.x+=Math.sin(angle),e.tilt=15*Math.sin(e.tiltAngle-t/3)}function u(e,t,i,s){e.x=t,e.y=i,e.tilt=s}function p(){W=window.innerWidth,H=window.innerHeight,canvas_confettis.width=W,canvas_confettis.height=H,function e(){return animationComplete?null:(animationHandler=requestAnimFrame(e),o())}()}function d(){clearTimeout(reactivationTimerHandler),clearTimeout(animationHandler)}function f(){confettiActive=!1,d()}function h(){animationComplete=!0,void 0!=ctx&&ctx.clearRect(0,0,W,H)}function m(){d(),h(),reactivationTimerHandler=setTimeout(function(){confettiActive=!0,animationComplete=!1,n()},100)}var e={colorOptions:["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"],colorIndex:0,colorIncrementer:0,colorThreshold:10,getColor:function(){return this.colorIncrementer>=10&&(this.colorIncrementer=0,this.colorIndex++,this.colorIndex>=this.colorOptions.length&&(this.colorIndex=0)),this.colorIncrementer++,this.colorOptions[this.colorIndex]}};this.initConfettis=function(e){s(e),i(),n(),$(window).resize(function(){W=window.innerWidth,H=window.innerHeight,canvas_confettis.width=W,canvas_confettis.height=H})},this.start_confettis=function(){confettiActive||m()},this.stop_confettis=function(){f(),_stopped=!0},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}}()};
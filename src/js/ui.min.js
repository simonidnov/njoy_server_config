var ui={event:"click",templates:{header:null,footer:null},page_params:{page:"default",params:{}},init:function(){"ontouchstart"in window&&(this.event="click"),"undefined"!=typeof StatusBar&&StatusBar.hide(),this.load_templates(),this.setListeners()},load_templates:function(){_.each(_.keys(this.templates),function(e,t){$.get("views/"+e+".tmpl",$.proxy(function(t){ui.templates[e]=_.template(t)},this))}),0===$("#ui_layer").length&&$("body").append('<div class="ui_layer" id="ui_layer"></div>'),0===$("#ui_templates").length&&($("body").append('<div class="ui_templates" id="ui_templates"></div>'),$.get("views/ui/popin.tmpl",$.proxy(function(e){ui.templates.popin=_.template(e)},this)),$.get("views/ui/notification.tmpl",$.proxy(function(e){ui.templates.notification=_.template(e)},this))),setTimeout($.proxy(function(){$("body").append(this.templates.header({})),$("body").append(this.templates.footer({})),this.navigate(this.page_params.page),this.setListeners()},this),200)},test_popin:function(){ui.popin({illus:"url",title:"test",message:"message test",buttons:[{label:"button 1"},{label:"button 2"}]},function(e){console.log(e)})},popin:function(e,t){$("#popin_ui_content").length>0&&$("#popin_ui_content").remove(),ui.popin_callBack=t,$("body").append(ui.templates.popin(e)),$("#popin_ui_content .popin").css("top","100%"),TweenMax.to($("#popin_ui_content .popin"),.5,{top:0,ease:Back.easeOut}),$("[data-popbutton]").on(ui.event,function(e){ui.close_popin($(this).attr("data-popbutton"))}),$("#close_popin").on(ui.event,function(){ui.close_popin()}),setTimeout(function(){ui.close_popin()},2e3)},close_popin:function(e){TweenMax.to($("#popin_ui_content .popin"),.5,{top:"100%",opacity:0,ease:Back.easeIn}),TweenMax.to($("#popin_ui_content"),.5,{opacity:0,delay:.5,onComplete:function(){$("#popin_ui_content").remove()}}),ui.popin_callBack(e)},openTeam:function(){$(".teams").addClass("opened"),$(".teams .cross_button").off("click").on("click",$.proxy(function(){this.closeTeam()},this)),$("#add_team").off("click").on("click",function(e){return e.preventDefault(),""===$("#team_name").val()?(ui.popin({illus:"img/logout_illus.svg",title:"TEAM",message:"Pour ajouter une équipe vous devez indiquer un nom dans",buttons:[{label:"OK"}]},function(e){1===parseInt(e)&&ui.navigate("/")}),!1):_.where(app.teams,{label:$("#team_name").val()}).length>0?(ui.popin({illus:"img/logout_illus.svg",title:"TEAM",message:"Le nom de l'équipe "+$("#team_name").val()+" existe déjà, veuillez choisir un nom d'équipe différent",buttons:[{label:"OK"}]},function(e){1===parseInt(e)&&ui.navigate("/")}),!1):(app.socket.emit("njoy",{status:"new_team",new_team:{label:$("#team_name").val(),score:0}}),void $("#team_name").val(""))})},closeTeam:function(){$(".teams").removeClass("opened")},set_teams:function(){if($("#team_list").html(""),void 0===app.teams)return!1;for(var e=_.template($("#team_template").html()),t=0;t<app.teams.length;t++)app.teams[t].id=t,$("#team_list").append(e(app.teams[t]));$(".delete_team_button").off("click").on("click",function(){app.socket.emit("njoy",{status:"delete_team",id:$(this).attr("data-id")})}),$(".less_score_button").off("click").on("click",function(){$(this).parent().find(".score").val(parseInt($(this).parent().find(".score").val())-1),app.socket.emit("njoy",{status:"team_score",id:$(this).attr("data-id"),score:$(this).parent().find(".score").val()})}),$(".more_score_button").off("click").on("click",function(){$(this).parent().find(".score").val(parseInt($(this).parent().find(".score").val())+1),app.socket.emit("njoy",{status:"team_score",id:$(this).attr("data-id"),score:$(this).parent().find(".score").val()})}),$(".set_score_input").off("blur").on("blur",function(){app.socket.emit("njoy",{status:"team_score",id:$(this).attr("data-id"),score:$(this).parent().find(".score").val()})})},setListeners:function(){$("[data-navigate]").off(ui.event).on(ui.event,function(e){return"/team"===$(this).attr("data-navigate")?(ui.openTeam(),!1):(void 0!==$(this).attr("data-direction")&&(ui.direction=$(this).attr("data-direction")),ui.navigate($(this).attr("data-navigate")),e.preventDefault(),!1)}),$("[data-action]").off(ui.event).on(ui.event,function(){switch($(this).attr("data-action")){case"drawing":console.log("EMIT ::::::::: status ",e),app.socket.emit("njoy",{status:"drawer"});break;case"cast":var e={};void 0!==$(this).attr("data-type")&&(e.status=$(this).attr("data-type")),void 0!==$(this).attr("data-file")&&(e.file=$(this).attr("data-file")),void 0!==$(this).attr("data-menu")&&(e.menu=$(this).attr("data-menu")),void 0!==$(this).attr("data-component")&&(e.component=$(this).attr("data-component")),void 0!==$(this).attr("data-componentid")&&(e.component_id=$(this).attr("data-componentid")),void 0!==$(this).attr("data-chronos")&&(e.chronos=$(this).attr("data-chronos")),void 0!==$(this).attr("data-data")&&(e.data=$(this).attr("data-data")),void 0!==$(this).attr("data-chronostype")&&(e.chronos_type=$(this).attr("data-chronostype")),"audio"===$(this).attr("data-type")&&("img/pause_icon.svg"===$(this).find("img").attr("src")?($(this).find("img").attr("src","img/play_icon.svg"),e.status="pause_audio"):($('[data-type="audio"] img').attr("src","img/play_icon.svg"),$(this).find("img").attr("src","img/pause_icon.svg"))),void 0!==$(this).attr("data-selectedapp")?e.tools=app.selected_app:e.tools=app.selected_tool,console.log("EMIT ::::::::: status ",e),app.socket.emit("njoy",e),$(".choices").css("display","none"),$(this).parent().find(".choices").length>0&&$(this).parent().find(".choices").css("display","block");break;case"response":$(this).addClass("checked"),app.socket.emit("njoy",{status:$(this).attr("data-type"),response:$(this).attr("data-id"),type:$(this).attr("data-type")})}})},navigate:function(e){if(app.socket_callback=null,app.socket_callback=function(e){},-1!==e.indexOf("logout"))return ui.popin({illus:"img/logout_illus.svg",title:"Déconnexion",message:"Si vous continuez vous allez vous déconnecter du serveur.<br/>Êtes vous certain de vouloir continuer ?",buttons:[{label:"Annuler"},{label:"Déconnexion",class:"error"}]},function(e){1===parseInt(e)&&ui.navigate("/")}),!1;this.setParams(e),this.load_dependencies()},load_dependencies:function(){""===this.page_params.page?this.page_params.page="default":this.page_params.page=this.page_params.page,$.getJSON("pages/"+this.page_params.page+"/descriptor.json",function(e){ui.descriptor=JSON.parse(JSON.stringify(e)),$.get("pages/"+ui.page_params.page+"/"+ui.descriptor.content.uri,function(e){$("body").append('<div class="blocker"></div>'),ui.templates[ui.page_params.page]=_.template(e),$("body main.app").append(ui.templates[ui.page_params.page](ui.descriptor.content.datas)),$("body main.app .screen").last().css("left","100%");for(var t=0;t<ui.descriptor.dependencies.css.length;t++)if(0===$('link[href="pages/'+ui.page_params.page+"/"+ui.descriptor.dependencies.css[t]+'"]').length){var i=document.getElementsByTagName("head")[0],a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.href="pages/"+ui.page_params.page+"/"+ui.descriptor.dependencies.css[t],a.media="all",i.appendChild(a)}for(var n=0;n<ui.descriptor.dependencies.js.length;n++)$.getScript("pages/"+ui.page_params.page+"/"+ui.descriptor.dependencies.js[n],function(e){});$.getScript("pages/"+ui.page_params.page+"/"+ui.descriptor.class+".js",function(e){if($("body main.app .screen").length>2)for(var t=0;t<$("body main.app .screen").length-1;t++)$("body main.app .screen").eq(t).remove();$("body main.app .screen").length>1?("back"===ui.direction?(TweenMax.to($("body main.app .screen").first(),.5,{left:"100%"}),TweenMax.set($("body main.app .screen").last(),{left:"-100%"})):TweenMax.to($("body main.app .screen").first(),.5,{left:"-100%"}),TweenMax.to($("body main.app .screen").last(),.5,{left:"0%",onComplete:function(){window[ui.descriptor.class].init(),$("body main.app .screen").first().remove(),ui.init_scroll_view(),$(".blocker").remove()}}),ui.direction=""):($("body main.app .screen").last().css("left","0%"),window[ui.descriptor.class].init(),$(".blocker").remove(),ui.init_scroll_view())}),_.isUndefined(ui.descriptor.header)||!0!==ui.descriptor.header.display?$("header").css("top","-80px").remove(".header-navbar"):($("header").css("top","0px"),ui.init_navbar()),!0!==ui.descriptor.footer.display?$("footer").css("bottom","-80px"):$("footer").css("bottom","0px"),ui.setListeners()})})},display_error:function(e){$(".ui_layer").append(ui.templates.notification(e)),$(".cross_close").off(ui.event).on(ui.event,function(){$(this).parent().remove()}),TweenMax.to($(".notification"),.5,{opacity:0,delay:1.5,onComplete:function(){$(".notification").remove()}})},setParams:function(e){e=e.replace("/","").split("/"),this.page_params.page=e[0],this.page_params.params={};for(var t=1;t<e.length;t+=2)this.page_params.params[e[t]]=e[t+1]},init_navbar:function(){if(void 0!==ui.descriptor.header.nav_left){$("header .left_nav").remove();for(var e=0;e<ui.descriptor.header.nav_left.length;e++)$("header").append('<div class="left_nav"><div class="head_button" data-navigate="'+ui.descriptor.header.nav_left[e].link+'"><div class="icon" style="background-image:url(img/'+ui.descriptor.header.nav_left[e].icon+'.svg);"></div><span>'+ui.descriptor.header.nav_left[e].label+"</span></div></div>"),void 0!==ui.descriptor.header.nav_left[e].direction&&$('[data-navigate="'+ui.descriptor.header.nav_left[e].link+'"]').attr("data-direction",ui.descriptor.header.nav_left[e].direction);for(e=0;e<ui.descriptor.header.nav_right.length;e++)0===$(".right_nav").length?$("header").append('<div class="right_nav"></div>'):$("header .right_nav").html(""),$("header .right_nav").append('<div class="head_button" data-navigate="'+ui.descriptor.header.nav_right[e].link+'"><div class="icon" style="background-image:url(img/'+ui.descriptor.header.nav_right[e].icon+'.svg);"></div><span>'+ui.descriptor.header.nav_right[e].label+"</span></div>"),void 0!==ui.descriptor.header.nav_right[e].direction&&$('[data-navigate="'+ui.descriptor.header.nav_right[e].link+'"]').attr("data-direction",ui.descriptor.header.nav_right[e].direction)}!_.isUndefined(ui.descriptor.header.tab_bar)&&ui.descriptor.header.tab_bar.length>0&&$.get("views/header-navbar.tmpl",$.proxy(function(e){function t(){$("header .select_bar").css({width:$(".header-navbar ul li.selected").first().outerWidth(),left:$(".header-navbar ul li.selected").first().position().left})}var i=_.template(e);$("header").append(i(ui.descriptor.header)),$("header .select_bar").css({width:$(".header-navbar ul li").first().width(),left:$(".header-navbar ul li").first().position().left}),t(),$("header .header-navbar li").off(ui.event).on(ui.event,function(){$("header .header-navbar li").removeClass("selected"),$(this).addClass("selected"),t()})},this))},init_scroll_view:function(){$(".screen").css({height:window.innerHeight-$("header").height(),overflow:"hidden"}),$(".screen .wrapper").css({height:"100%",width:"100%",overflow:"hidden"}),$(".screen .wrapper .scroller").css({display:"table",width:"100%"}),$(".screen .wrapper .scroller").length},open_wifi_settings:function(){window.cordova&&window.cordova.plugins.settings?(console.log("openNativeSettingsTest is active"),window.cordova.plugins.settings.open("wifi",function(){console.log("opened settings")},function(){console.log("failed to open settings")})):console.log("openNativeSettingsTest is not active!")},check_wifi:function(){void 0!==navigator.connection&&"wifi"!==navigator.connection.type&&ui.popin({illus:"img/logout_illus.svg",title:"WIFI",message:"Pour utiliser l'application vous devez activer la WIFI et vous connecter sur le réseau NJOY avec le mot de passe njoynjoy.",buttons:[{label:"Activer la WIFI",class:"error"}]},function(e){ui.open_wifi_settings()})},reboot_server:function(){app.socket.emit("njoy",{status:"reboot"})},battery_low:function(){ui.popin({illus:"img/energy.svg",title:"BATTERIE",message:"Attention votre batterie est bientôt vide, veuillez brancher votre appareil.",buttons:[{label:"J'ai compris",class:"success"}]},function(e){})},open_webview:function(){cordova&&cordova.InAppBrowser?cordova.InAppBrowser.open(url,target,options):ui.popin({title:"INFOS",message:"Nous avons un problème avec le chargement de ce contenu, veuillez contacter NJOY pour en savoir plus.",buttons:[{label:"J'ai compris",class:"success"}]},function(e){})}};
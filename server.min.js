function get_ip_config(){Object.keys(ifaces).forEach(function(e){var s=0;ifaces[e].forEach(function(e){return"IPv4"===e.family&&e.internal===!1?s>=1?e.address:e.address:void 0})})}var app=require("express")(),router=express.Router(),http=require("http").Server(app),path=require("path"),io=require("socket.io")(http),port=process.env.PORT||3e3,_=require("underscore"),users=[],server=null,os=require("os"),ifaces=os.networkInterfaces(),ip_config=get_ip_config(),cp=require("child_process");$=require("jquery"),module.exports=router,app.use(express["static"](__dirname+"./src")),app.get("/",function(e,s){s.sendFile("index.html",{root:path.join(__dirname,"./src")})}),io.on("connection",function(e){console.log("a user connected"),e.on("disconnect",function(){console.log("user disconnected")}),e.on("njoy",function(e){users_activities.push(e),e=addParams(e);var s={},t="njoy";switch(e.status){case"connect":s=login(e),e=addParams(e),io.emit("njoy_"+e.uuid,{status:s.status,infos:s,datas:e}),t="njoy";break;case"disconnect":s=logout(e),e=addParams(e);break;case"activities":s.status="activities",e.users_activities=users_activities;break;case"message":s.status="message";break;case"launch_content":s.status="launch_content";break;default:s={status:"default"}}console.log("call ::: ",t," stat ",s),io.emit(t,{status:s.status,infos:s,datas:e})}),e.on("chat message",function(e){io.emit("chat message",e)})}),http.listen(port,function(){console.log("listening on *:"+port)});var login=function(e){return"undefined"==typeof users&&(users=[]),_.where(users,{user_name:e.user_name}).length>0?{status:"login_error",message:"need uniq pseudo"}:(users.push({user_name:e.user_name,uuid:e.uuid}),0===_.where(users,{regis:"true"}).length&&(users[users.length-1].regis="true"),{status:"login_success",message:"success login",users:users})},logout=function(e){return require("underscore"),users=_.without(users,_.findWhere(users,{uuid:e.uuid})),{status:"logout_success",message:"success lougout"}},addParams=function(e){return"undefined"==typeof e&&(e={}),e.users=users,e.animations=animations,e.ip_config=get_ip_config(),e},users_activities=[],animations=null;
function get_ip_config(){Object.keys(ifaces).forEach(function(e){var i=0;ifaces[e].forEach(function(e){return"IPv4"===e.family&&e.internal===!1?i>=1?e.address:e.address:void 0})})}var express=require("express"),app=express(),router=express.Router(),http=require("http").Server(app),path=require("path"),io=require("socket.io")(http),port=process.env.PORT||3e3,_=require("underscore"),users=[],server=null,os=require("os"),ifaces=os.networkInterfaces(),ip_config=get_ip_config(),spawn=require("child_process").spawn,cp=require("child_process"),Omx=require("node-omxplayer"),video_player=null;$=require("jquery");var http2=require("http"),fs=require("fs");module.exports=router,app.use(express["static"]("./src")),app.get("*",function(e,i){i.sendFile("njoy/src/index.html",{root:path.join(__dirname,"../")})}),io.on("connection",function(e){console.log("a user connected"),e.on("disconnect",function(){console.log("user disconnected")}),e.on("njoy",function(e){users_activities.push(e),e=addParams(e);var i={},o="njoy";switch(e.status){case"reboot":cp.exec("/home/pi/startchromium.sh",function(e,i,o){console.log("stdout: "+i),console.log("stderr: "+o),null!==e&&console.log("exec errror: "+e)});case"connect":i=login(e),e=addParams(e),io.emit("njoy_"+e.uuid,{status:i.status,infos:i,datas:e}),o="njoy";break;case"disconnect":i=logout(e),e=addParams(e);break;case"activities":i.status="activities",e.users_activities=users_activities;break;case"message":i.status="message";break;case"launch_content":i.status="launch_content";break;default:i={status:"default"}}"pause_video"===e.status&&(null!==video_player&&(video_player.pause(),io.emit(o,{status:"video_pause",is_running:video_player.running})),console.log("video_player pause ",video_player)),"play_video"===e.status&&null!==video_player&&(video_player.play(),io.emit(o,{status:"video_play",is_running:video_player.running})),"mute_video"===e.status&&null!==video_player&&(video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),video_player.volDown(),io.emit(o,{status:"video_muted",is_running:video_player.running})),"audio_video"===e.status&&null!==video_player&&(video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),video_player.volUp(),io.emit(o,{status:"video_audio",is_running:video_player.running})),"fast_forward_video"===e.status&&null!==video_player&&(video_player.fwd30(),io.emit(o,{status:"fast_forward_video",is_running:video_player.running})),"fast_backward_video"===e.status&&null!==video_player&&(video_player.back30(),io.emit(o,{status:"fast_backward_video",is_running:video_player.running})),"stop_video"===e.status&&(null!==video_player&&(video_player.quit(),video_player=null),cp.exec("export DISPLAY=:0",function(e,i,o){}),cp.exec("killall omxplayer",function(e,i,o){}),io.emit(o,{status:"kill_vid"})),"video"===e.status?null!==video_player?(video_player.quit(),video_player=null,cp.exec("export DISPLAY=:0",function(e,i,o){}),cp.exec("killall omxplayer",function(e,i,o){}),io.emit(o,{status:"kill_vid"})):cp.exec("killall omxplayer",function(r,s,a){null!==a?(console.log("HEEEEEEEERE WTF !!!"),e.status="force_video",io.emit(o,{status:"force_video",infos:i,datas:e})):(null!==video_player&&(video_player.quit(),video_player=null),cp.exec("export DISPLAY=:0",function(e,i,o){}),video_player=Omx("http://10.3.141.1:3000/"+e.file,"local",!1,1),video_player.volUp(),video_player.play(),video_player.on("close",function(){io.emit(o,{status:"video_closed"}),video_player=null}),io.emit(o,{status:"video_started"}))}):-1===e.status.indexOf("video")&&(null!==video_player&&(video_player.quit(),io.emit(o,{status:"video_closed"}),video_player=null),cp.exec("killall omxplayer",function(e,i,o){null!==o&&console.log("killall omxplayer exec errror: "+e)}),cp.exec("killall omxplayer.bin",function(e,i,o){null!==o&&console.log("killall omxplayer exec errror: "+e)})),io.emit(o,{status:i.status,infos:i,datas:e})}),e.on("chat message",function(e){io.emit("chat message",e)})}),http.listen(port,function(){console.log("listening on *:"+port),cp.exec("/home/pi/startchromium.sh",function(e,i,o){})});var login=function(e){return"undefined"==typeof users&&(users=[]),_.where(users,{user_name:e.user_name}).length>0?{status:"login_error",message:"need uniq pseudo"}:(users.push({user_name:e.user_name,uuid:e.uuid}),0===_.where(users,{regis:"true"}).length&&(users[users.length-1].regis="true"),{status:"login_success",message:"success login",users:users})},logout=function(e){return require("underscore"),users=_.without(users,_.findWhere(users,{uuid:e.uuid})),{status:"logout_success",message:"success lougout"}},addParams=function(e){return"undefined"==typeof e&&(e={}),e.users=users,e.animations=animations,e.ip_config=get_ip_config(),e},users_activities=[],animations=null;
var express=require("express"),app=express(),router=express.Router(),path=require("path"),users=[],server=null,http=require("http").Server(app),port=8080,os=require("os"),ifaces=os.networkInterfaces(),ip_config=get_ip_config(),io=require("socket.io")(http),_=require("underscore");$=require("jquery");module.exports=router;app.get("*",function(b,a){console.log(b," ::: ",a);a.sendFile("server/src/index.html",{root:path.join(__dirname,"../")})});app.listen(port,function(){console.log("app start listenning ",port)});io.on("connection",function(a){console.log("a user connected");a.on("disconnect",function(){console.log("user disconnected")});a.on("njoy",function(b){users_activities.push(b);b=addParams(b);var d={},c="njoy";switch(b.status){case"connect":d=login(b);b=addParams(b);io.emit("njoy_"+b.uuid,{status:d.status,infos:d,datas:b});c="njoy";break;case"disconnect":d=logout(b);b=addParams(b);break;case"activities":d.status="activities";b.users_activities=users_activities;break;case"message":d.status="message";break;case"launch_content":d.status="launch_content";console.log(b);break;default:d={status:"default"};break}console.log("call ::: ",c," stat ",d);io.emit(c,{status:d.status,infos:d,datas:b})})});http.listen(3000,function(){console.log("listening on *:3000")});var login=function(a){if(typeof users==="undefined"){users=[]}if(_.where(users,{user_name:a.user_name}).length>0){return{status:"login_error",message:"need uniq pseudo"}}users.push({user_name:a.user_name,uuid:a.uuid});if(_.where(users,{regis:"true"}).length===0){users[users.length-1].regis="true"}return{status:"login_success",message:"success login",users:users}};var logout=function(a){require("underscore");users=_.without(users,_.findWhere(users,{uuid:a.uuid}));return{status:"logout_success",message:"success lougout"}};var addParams=function(a){if(typeof a==="undefined"){a={}}a.users=users;a.animations=animations;a.ip_config=get_ip_config();return a};function get_ip_config(){Object.keys(ifaces).forEach(function(b){var a=0;ifaces[b].forEach(function(c){if("IPv4"!==c.family||c.internal!==false){return}if(a>=1){return c.address}else{return c.address}++a})})}var users_activities=[];var animations=null;